<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŒ¦ç¹¡å…¬å¯“</title>
    <style>
        :root {
            --bg-color: #020202;
            --text-color: #b0b0b0; 
            --highlight-color: #4caf50;
            --danger-color: #d32f2f;
            --warning-color: #ff9800;
            --dim-color: #444;
            --panel-bg: #0a0a0a;
            --border-color: #333;
            --header-height: 70px;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Courier New", Courier, monospace;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: filter 0.5s ease;
        }

        /* --- è¦–è¦ºå¢å¼·ï¼šæš—è§’èˆ‡é›œè¨Š --- */
        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle, rgba(0,0,0,0) 50%, rgba(0,0,0,0.8) 100%);
            pointer-events: none;
            z-index: 998;
        }

        .crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 999;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.92; }
            50% { opacity: 0.88; }
            100% { opacity: 0.92; }
        }

        /* --- ç‰¹æ•ˆå‹•ç•« --- */
        @keyframes damage-flash {
            0% { box-shadow: inset 0 0 0 transparent; background-color: rgba(255,0,0,0); }
            20% { box-shadow: inset 0 0 150px var(--danger-color); background-color: rgba(50,0,0,0.2); }
            100% { box-shadow: inset 0 0 0 transparent; background-color: transparent; }
        }

        @keyframes sanity-flash {
            0% { filter: invert(0); transform: scale(1); }
            10% { filter: invert(0.5); transform: scale(1.02) skewX(5deg); }
            20% { filter: invert(0); transform: scale(1); }
            30% { filter: invert(0.2); transform: scale(0.98) skewX(-5deg); }
            100% { filter: invert(0); transform: scale(1); }
        }

        .effect-damage { animation: damage-flash 0.4s ease-out; }
        .effect-sanity { animation: sanity-flash 0.5s ease-out; }
        
        /* --- æ¨™é¡Œæ¬„ --- */
        header {
            background-color: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            padding: 5px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            z-index: 20;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .status-group {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 2px;
        }

        @media (min-width: 600px) {
            .status-group {
                flex-direction: row;
                gap: 20px;
                align-items: center;
            }
        }

        .status-item span { font-weight: bold; transition: color 0.3s; }
        .status-sanity { color: #29b6f6; text-shadow: 0 0 8px rgba(41, 182, 246, 0.4); }
        .status-stamina { color: #9ccc65; text-shadow: 0 0 8px rgba(156, 204, 101, 0.4); }
        .status-corruption { color: #ef5350; text-shadow: 0 0 8px rgba(239, 83, 80, 0.4); }

        /* --- ä¸»éŠæˆ²å€åŸŸ --- */
        #game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        #game-log {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: auto;
            border-left: 1px solid #222;
            border-right: 1px solid #222;
            background: #050505;
            text-shadow: 0 0 2px rgba(255,255,255,0.1); 
            padding-bottom: 60px; /* é˜²æ­¢è¢«è¨ˆæ™‚æ¢é®æ“‹ */
        }

        .log-entry { margin-bottom: 15px; line-height: 1.6; border-left: 2px solid transparent; padding-left: 8px;}
        .log-entry.system { color: #666; font-style: italic; border-color: #444; font-size: 0.9em; }
        .log-entry.event { color: var(--text-color); }
        .log-entry.danger { color: #e53935; border-color: #b71c1c; background: linear-gradient(90deg, rgba(183, 28, 28, 0.1), transparent); text-shadow: 0 0 8px rgba(229, 57, 53, 0.4); }
        .log-entry.success { color: #66bb6a; border-color: #2e7d32; text-shadow: 0 0 5px rgba(102, 187, 106, 0.3); }
        .log-entry.insane { color: #bf360c; font-family: "Impact", sans-serif; letter-spacing: 1px; transform: skewX(-5deg); text-shadow: 2px 2px 0px #000; }
        
        .cursor::after {
            content: 'â–ˆ';
            animation: cursor-blink 0.8s infinite;
            margin-left: 2px;
            color: var(--highlight-color);
            vertical-align: middle;
        }
        @keyframes cursor-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* --- ææ…Œè¨ˆæ™‚æ¢ (Panic Bar) --- */
        #panic-container {
            position: relative;
            width: 100%;
            height: 6px;
            background: #222;
            margin-bottom: 0;
            display: none; /* é è¨­éš±è— */
            z-index: 50;
        }
        #panic-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, #4caf50, #ff9800, #f44336);
            transform-origin: left;
            transition: width 0.1s linear;
        }
        #panic-text {
            position: absolute;
            top: -25px;
            right: 10px;
            color: #d32f2f;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            animation: blink 0.5s infinite;
        }

        /* --- é¸é …æŒ‰éˆ•å€ --- */
        #choices-area {
            background-color: #0c0c0c;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            max-height: 45vh; 
            overflow-y: auto; 
            flex-shrink: 0;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.9);
            opacity: 0; 
            transition: opacity 0.5s ease;
        }
        
        #choices-area.show { opacity: 1; }

        button {
            background: linear-gradient(90deg, #111, #0a0a0a);
            color: #ccc;
            border: 1px solid #333;
            padding: 16px 20px;
            cursor: pointer;
            text-align: left;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.15s;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 4px; height: 100%;
            background: #333;
            transition: all 0.2s;
        }

        button:hover:not(:disabled) {
            background: #1a1a1a;
            color: #fff;
            padding-left: 25px;
            border-color: #555;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }

        button:hover:not(:disabled)::before {
            background: var(--highlight-color);
            width: 6px;
            box-shadow: 0 0 10px var(--highlight-color);
        }

        button:active:not(:disabled) { transform: scale(0.99); }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        /* --- è¦–è¦ºæ¬ºè©ç‰¹æ•ˆ (Hallucinations) --- */
        .btn-shake { animation: btn-shake 0.5s infinite; }
        @keyframes btn-shake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-2px, 2px); }
            50% { transform: translate(2px, -2px); }
            75% { transform: translate(-2px, -2px); }
            100% { transform: translate(0, 0); }
        }

        .btn-blur { filter: blur(1.5px); transition: 0.2s; }
        .btn-blur:hover { filter: blur(0); }

        .btn-glitch-text { color: transparent !important; text-shadow: 2px 0 #f00, -2px 0 #0ff; position: relative; }

        button.choice-rest:hover::before { background: #29b6f6; box-shadow: 0 0 10px #29b6f6; }
        
        button.choice-insane { 
            border: 1px dashed var(--danger-color); 
            color: var(--danger-color); 
            animation: textShake 2s infinite;
        }

        #action-bar { display: flex; gap: 8px; }
        .action-btn {
            background: #1a1a1a;
            border: 1px solid #444;
            color: #ddd;
            padding: 6px 14px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .action-btn:hover { background: #333; border-color: #888; color: #fff; }

        /* --- å•Ÿå‹•é®ç½© --- */
        #start-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #fff;
            cursor: pointer;
        }
        #start-overlay h1 { color: var(--danger-color); text-shadow: 0 0 10px red; letter-spacing: 5px; text-align: center;}
        #start-overlay p { color: #888; animation: blink 1.5s infinite; margin-top: 10px;}
        
        @keyframes blink { 50% { opacity: 0.3; } }

        /* --- æ¨¡æ…‹è¦–çª— --- */
        .modal {
            display: none;
            position: fixed;
            top: var(--header-height); 
            left: 0;
            width: 100%;
            height: calc(100% - var(--header-height));
            background: rgba(0,0,0,0.92);
            z-index: 100;
            justify-content: center;
            align-items: flex-start;
            padding-top: 20px;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: #0f0f0f;
            border: 1px solid var(--border-color);
            padding: 25px;
            width: 90%;
            max-width: 650px;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,1);
        }

        .close-btn {
            position: sticky;
            top: 0;
            float: right;
            background: #222;
            padding: 2px 12px;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
            border: 1px solid #555;
        }

        h2 { margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; color: var(--highlight-color); text-transform: uppercase; letter-spacing: 2px;}
        
        .rule-list { padding-left: 20px; margin: 0; }
        .rule-list li { margin-bottom: 18px; padding: 10px; border-left: 3px solid #333; line-height: 1.5; background: rgba(255,255,255,0.02); transition: 0.3s; }
        .rule-list li:hover { background: rgba(255,255,255,0.05); border-left-color: #555; }
        
        .rule-corrupted { 
            color: var(--danger-color); 
            font-weight: bold; 
            background: rgba(244, 67, 54, 0.05); 
            display: block; 
            padding: 5px; 
            border: 1px dashed rgba(244, 67, 54, 0.3);
        }
        
        .rule-scratched { text-decoration: line-through; color: var(--dim-color); opacity: 0.6; }

        .scribble {
            font-family: "Impact", sans-serif;
            color: #ef5350;
            transform: rotate(-2deg);
            display: inline-block;
            text-shadow: 1px 1px 0 #000;
        }
        
        @keyframes textShake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } }
        
        .glitch-text { position: relative; }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.7;
        }
        .glitch-text::before { color: #f0f; transform: translate(-2px, 0); animation: glitch-anim-1 2s infinite linear alternate-reverse; }
        .glitch-text::after { color: #0ff; transform: translate(2px, 0); animation: glitch-anim-2 3s infinite linear alternate-reverse; }

        @keyframes glitch-anim-1 { 0% { clip-path: inset(20% 0 80% 0); } 100% { clip-path: inset(80% 0 20% 0); } }
        @keyframes glitch-anim-2 { 0% { clip-path: inset(10% 0 90% 0); } 100% { clip-path: inset(90% 0 10% 0); } }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 0; border: 1px solid #111; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        .game-over-screen { text-align: center; padding: 20px; animation: fadeIn 2s; }
        .game-over-title { font-size: 2.5rem; color: var(--danger-color); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 20px var(--danger-color); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
/* --- æ–°å¢ï¼šCCTV ç›£æ§ç³»çµ±æ¨£å¼ --- */
#cctv-modal .modal-content {
    background: #001100; /* æ·±ç¶ è‰²èƒŒæ™¯ */
    border: 2px solid #0f0;
    box-shadow: 0 0 20px #0f0, inset 0 0 50px #000;
    color: #0f0;
    font-family: "VT323", monospace; /* å¦‚æœæœ‰å¼•å…¥å­—é«”æœ€å¥½ï¼Œæ²’æœ‰å°±ç”¨é è¨­ */
    text-shadow: 0 0 5px #0f0;
    max-width: 800px;
}

#cctv-screen {
    width: 100%;
    height: 300px;
    background: #000;
    border: 1px solid #004400;
    margin-bottom: 15px;
    position: relative;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    background-image: repeating-linear-gradient(0deg, transparent, transparent 1px, #001100 1px, #001100 2px);
}

.cctv-noise {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: url('data:image/svg+xml;utf8,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noiseFilter"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noiseFilter)" opacity="0.15"/%3E%3C/svg%3E');
    pointer-events: none;
    z-index: 5;
    animation: staticNoise 0.2s infinite;
}

#cctv-content {
    z-index: 2;
    text-align: center;
    font-size: 1.2rem;
    padding: 20px;
}

.cam-btn-group {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

.cam-btn {
    background: #002200;
    border: 1px solid #006600;
    color: #00aa00;
    padding: 10px;
    cursor: pointer;
    font-family: inherit;
    transition: 0.2s;
}
.cam-btn:hover { background: #004400; color: #0f0; box-shadow: 0 0 10px #0f0; }
.cam-btn.active { background: #0f0; color: #000; font-weight: bold; }
.cam-btn.danger-cam { border-color: red; color: red; animation: blink 1s infinite; }

/* --- æ–°å¢ï¼šUI æ¬ºè©ç‰¹æ•ˆ --- */
.btn-runaway {
    position: absolute !important; /* å¼·åˆ¶çµ•å°å®šä½ä»¥ä¾¿ç§»å‹• */
    transition: top 0.1s, left 0.1s;
    z-index: 1000;
    background: #220000 !important; /* è­¦ç¤ºè‰² */
    border-color: red !important;
}

.fake-stat {
    animation: stat-glitch 0.3s infinite;
    color: red !important;
}

@keyframes stat-glitch {
    0% { opacity: 1; transform: translate(0); }
    20% { opacity: 0.8; transform: translate(-2px, 2px); }
    40% { opacity: 1; transform: translate(2px, -1px); }
    60% { opacity: 0.9; transform: translate(-1px, 2px); }
    80% { opacity: 1; transform: translate(1px, -2px); }
    100% { opacity: 1; transform: translate(0); }
}

#btn-cctv {
    border: 1px solid #0f0;          /* äº®ç¶ è‰²é‚Šæ¡† */
    color: #0f0;                     /* äº®ç¶ è‰²æ–‡å­— */
    background: rgba(0, 50, 0, 0.6); /* æ·±ç¶ è‰²åŠé€æ˜èƒŒæ™¯ */
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.2); /* å¾®å¾®ç™¼å…‰ */
    font-weight: bold;
    margin-right: 10px;               /* è·Ÿå³é‚Šçš„æŒ‰éˆ•æ‹‰é–‹ä¸€é»è·é›¢ */
    letter-spacing: 1px;
    transition: all 0.3s ease;
}

#btn-cctv:hover {
    background: #0f0;                /* æ»‘é¼ ç§»éå»è®Šå…¨ç¶  */
    color: #000;                     /*æ–‡å­—è®Šé»‘ */
    box-shadow: 0 0 20px #0f0;       /* å¼·çƒˆç™¼å…‰ */
    transform: scale(1.05);          /* ç¨å¾®æ”¾å¤§ */
}

/* --- æ‰‹æ©Ÿç‰ˆçµ‚æ¥µä¿®æ­£ (é‡å°æŒ‰éˆ•æ¶ˆå¤±å•é¡Œ) --- */
@media (max-width: 768px) {
    /* 1. ä¿®æ­£é«˜åº¦å•é¡Œï¼šä½¿ç”¨ dvh (Dynamic Viewport Height) 
       é€™èƒ½è‡ªå‹•æ‰£é™¤æ‰‹æ©Ÿç€è¦½å™¨ç¶²å€åˆ—çš„é«˜åº¦ */
    body {
        height: 100dvh; 
        overflow: hidden; /* ç¦æ­¢æ•´é«”æ²å‹•ï¼Œåªè®“å°è©±æ¡†æ²å‹• */
    }

    /* 2. å£“ç¸®é ‚éƒ¨è³‡è¨Šæ¬„ï¼šæ‰‹æ©Ÿç›´å‘ç©ºé–“å¯¶è²´ï¼Œè¦è®Šç·Šæ¹Š */
    header {
        height: auto;
        padding: 5px 10px;
        flex-wrap: wrap;
        font-size: 0.75rem; /* å­—é«”ç¸®å° */
        gap: 5px;
        justify-content: space-between;
    }

    .status-group {
        flex-direction: row; /* ä¿æŒæ©«å‘ */
        gap: 10px;
        width: 100%;
        justify-content: space-between;
        border-bottom: 1px solid #222;
        padding-bottom: 2px;
        margin-bottom: 2px;
    }

    /* éš±è—è£é£¾æ€§çš„æ¨™ç±¤ï¼Œåªé¡¯ç¤ºæ•¸å€¼ï¼Œç¯€çœç©ºé–“ */
    .status-item { 
        display: flex; 
        align-items: center; 
    }

    /* 3. ç¢ºä¿éŠæˆ²ä¸»å€åŸŸæ­£ç¢ºä¼¸ç¸® */
    #game-container {
        flex: 1; /* ä½”æ“šå‰©é¤˜ç©ºé–“ */
        min-height: 0; /* é—œéµï¼šé˜²æ­¢å…§å®¹éé•·æ™‚æ’é–‹å®¹å™¨å°è‡´æŒ‰éˆ•è¢«æ¨èµ° */
        display: flex;
        flex-direction: column;
    }

    #game-log {
        flex: 1;
        overflow-y: auto; /* åªæœ‰é€™è£¡å¯ä»¥æ²å‹• */
        padding: 15px;
        font-size: 0.95rem;
        /* å¢åŠ åº•éƒ¨ç•™ç™½ï¼Œé˜²æ­¢æ–‡å­—è²¼åº• */
        padding-bottom: 20px; 
    }

    /* 4. å›ºå®šä¸¦å„ªåŒ–æŒ‰éˆ•å€ */
    #choices-area {
        flex-shrink: 0; /* é—œéµï¼šç¦æ­¢æ­¤å€åŸŸè¢«å£“ç¸®æˆ–æ¨æ“  */
        max-height: 40vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
        padding: 10px;
        background: #0c0c0c;
        border-top: 1px solid #333;
        z-index: 100; /* ç¢ºä¿æµ®åœ¨æœ€ä¸Šå±¤ */
        
        /* é‡å° iPhone X ä»¥ä¸Šçš„åº•éƒ¨æ©«æ¢ (Home Indicator) é¿è®“ */
        padding-bottom: calc(10px + env(safe-area-inset-bottom));
    }

    button {
        padding: 12px 15px; /* é©ä¸­å¤§å° */
        font-size: 1rem;
        margin-bottom: 8px;
    }

    /* 5. ç›£æ§èˆ‡åŠŸèƒ½æŒ‰éˆ•å„ªåŒ– */
    #action-bar {
        width: 100%;
        display: flex;
        justify-content: flex-end;
        gap: 5px;
    }
    
    .action-btn {
        padding: 4px 10px;
        font-size: 0.75rem;
    }

    /* 6. CCTV è¦–çª—èª¿æ•´ */
    #cctv-modal .modal-content {
        height: 80vh;
        width: 95vw;
        margin-top: 10vh;
    }
    #cctv-screen {
        height: 180px;
    }
    .cam-btn-group {
        grid-template-columns: repeat(3, 1fr);
    }
    .cam-btn {
        padding: 8px;
        font-size: 0.8rem;
    }
}
@media (max-width: 768px) {
    /* 1. æå‡å±¤ç´šï¼šç¢ºä¿ç›£æ§è¦–çª—æµ®åœ¨æ‰€æœ‰ç‰¹æ•ˆ(æƒæç·š)ä¹‹ä¸Šï¼Œæ‰å¥½é»æ“Š */
    .modal {
        z-index: 2000 !important;
    }

    /* 2. å½ˆçª—ä½ˆå±€æ”¹ç‚ºã€Œå½ˆæ€§ç›’å­ã€ï¼Œè®“å…§å®¹è‡ªå‹•é©æ‡‰é«˜åº¦ */
    #cctv-modal .modal-content {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 95vw;
        height: 85dvh; /* ä½¿ç”¨å‹•æ…‹é«˜åº¦ï¼Œç•™ä¸€é»é‚Šè· */
        max-height: none; /* è§£é™¤é™åˆ¶ */
        
        display: flex;
        flex-direction: column; /* å‚ç›´æ’åˆ— */
        overflow: hidden; /* ç¦æ­¢æ•´å€‹å¤§æ¡†æ¡†æ²å‹• */
        padding: 15px;
    }

    /* 3. æ¨™é¡Œèˆ‡è­¦å‘Šæ–‡å­—ï¼šå›ºå®šä¸ç¸®æ”¾ */
    #cctv-modal h2 {
        flex-shrink: 0;
        margin-bottom: 10px;
        font-size: 1.1rem;
    }
    
    #cctv-modal .modal-content > div:last-child {
        flex-shrink: 0;
        font-size: 0.75rem;
        margin-top: 5px;
    }

    /* 4. ç›£æ§è¢å¹•ï¼šå›ºå®šé«˜åº¦ï¼Œé¿å…å¤ªä½”ä½ */
    #cctv-screen {
        flex-shrink: 0;
        height: 30vh; /* ä½”æ“šè¢å¹•ç´„ 1/3 */
        min-height: 180px;
        margin-bottom: 10px;
    }

    /* 5. é—œéµä¿®å¾©ï¼šæŒ‰éˆ•å€åŸŸè¨­ç‚ºã€Œå¯ç¨ç«‹æ²å‹•ã€ */
    #cctv-controls {
        flex: 1; /* ä½”æ“šå‰©ä¸‹çš„æ‰€æœ‰ç©ºé–“ */
        overflow-y: auto; /* åªæœ‰é€™å€‹å€åŸŸå¯ä»¥æ»‘å‹•ï¼ */
        -webkit-overflow-scrolling: touch; /* iOS æ»‘å‹•å„ªåŒ– */
        
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* æŒ‰éˆ•æ’æˆå…©åˆ— */
        gap: 8px;
        align-content: start; /* æŒ‰éˆ•é ä¸Šå°é½Š */
        padding-right: 5px; /* ç•™çµ¦æ²è»¸ä¸€é»ç©ºé–“ */
    }

    /* è®“æŒ‰éˆ•æ›´å¥½æŒ‰ */
    .cam-btn {
        padding: 15px 5px;
        min-height: 50px;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* è®“ã€Œé–å®šç©ºé–“ä¸¦æ›´æ–°ã€æŒ‰éˆ•æ©«è·¨å…©æ¬„ï¼Œç‰¹åˆ¥é¡¯çœ¼ */
    .cam-btn:last-child {
        grid-column: 1 / -1; /* æ©«è·¨æ‰€æœ‰æ¬„ä½ */
        margin-top: 5px;
        background: rgba(0, 50, 0, 0.8);
        border: 1px dashed #0f0;
    }
}

    </style>
</head>
<body>

<div id="start-overlay" onclick="initAudioAndStart()">
    <h1>éŒ¦ç¹¡å…¬å¯“<br><span style="font-size:0.5em; color:white;">éµå®ˆè¦å‰‡</span></h1>
    <p>[ é»æ“Šè¢å¹•é€£æ¥ç¥ç¶“ä»‹é¢ ]</p>
    <div style="font-size: 0.8em; margin-top: 20px; color: #555;">è­¦å‘Šï¼šåŒ…å«å¼·çƒˆçš„å¿ƒç†ææ€–å…ƒç´ èˆ‡æ™‚é–“å£“åŠ›</div>
</div>

<div class="vignette"></div>
<div class="crt-overlay"></div> 

<header>
    <div class="status-group">
        <div>Day: <span id="disp-day">1</span></div>
        <div>Time: <span id="disp-time">00:00</span></div>
    </div>
    <div class="status-group">
        <div class="status-item status-sanity">ç²¾ç¥: <span id="disp-sanity">å†·éœ</span></div>
        <div class="status-item status-stamina">é«”åŠ›: <span id="disp-stamina">å……æ²›</span></div>
        <div class="status-item status-corruption">æ±¡æŸ“: <span id="disp-corruption">æ­£å¸¸</span></div>
    </div>
    <div id="action-bar">
<button class="action-btn" id="btn-cctv" onclick="CCTVSystem.open()">[ ç›£æ§ç³»çµ± ]</button>
        <button class="action-btn" onclick="openModal('rules-modal')">å®ˆå‰‡</button>
    <button class="action-btn" onclick="openModal('clues-modal')">ç­†è¨˜</button>
<button class="action-btn" style="color: #ff9800; border-color: #ff9800;" onclick="openModal('credits-modal')">ä½œè€…</button>
    </div>
</header>

<div id="cctv-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('cctv-modal')">&times;</span>
        <h2 style="border-bottom: 2px dashed #0f0; color: #0f0;">SECURITY_FEED_v0.9</h2>
        
        <div id="cctv-screen">
            <div class="cctv-noise"></div>
            <div id="cctv-overlay" style="position:absolute; top:10px; left:10px; color:#0f0; font-size:0.8rem;">REC â—</div>
            <div id="cctv-content">ç³»çµ±å¾…æ©Ÿä¸­...<br>é¸æ“‡æ”åƒé ­æ¥å…¥ä¿¡è™Ÿ</div>
        </div>

        <div class="cam-btn-group" id="cctv-controls">
            </div>
        
        <div style="margin-top: 15px; border-top: 1px solid #004400; padding-top: 10px; font-size: 0.8rem; color: #008800;">
            è­¦å‘Šï¼šé•·æ™‚é–“æ³¨è¦–ç›£æ§ç•«é¢å¯èƒ½å°è‡´ç²¾ç¥æŒ‡æ•¸ä¸‹é™ã€‚<br>ç™¼ç¾ç•°å¸¸è«‹ç«‹å³åŸ·è¡Œ [æ›´æ–°å”è­°]ã€‚
        </div>
    </div>
</div>

<main id="game-container">
    <div id="game-log"></div>
    <div id="panic-container">
        <div id="panic-text">PANIC</div>
        <div id="panic-bar"></div>
    </div>
    <div id="choices-area"></div>
</main>

<div id="rules-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('rules-modal')">&times;</span>
        <h2>ç‰©æ¥­å®‰å…¨ç®¡ç†è¦ç¯„ (v2.4)</h2>
        <div style="font-size:0.8em; color:#666; margin-bottom:10px;">è«‹åš´æ ¼åŸ·è¡Œä»¥ç¢ºä¿å‹å·¥å®‰å…¨èˆ‡æ¬Šç›Šã€‚</div>
        <ul id="rules-list" class="rule-list"></ul>
    </div>
</div>

<div id="clues-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('clues-modal')">&times;</span>
        <h2>èª¿æŸ¥ç­†è¨˜èˆ‡ç‰©å“</h2>
        <ul id="clues-list" class="rule-list">
            <li style="color: #666;">ç›®å‰å£è¢‹ç©ºç©ºå¦‚ä¹Ÿã€‚</li>
        </ul>
    </div>
</div>

<div id="credits-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('credits-modal')">&times;</span>
        <h2>ğŸ‘¨â€ğŸ’» ä½œè€…åå–®</h2>
        <div style="font-size:0.9em; color:#aaa; margin-bottom:20px; line-height: 1.5;">
            æ„Ÿè¬éŠç©ï¼æ­¡è¿é—œæ³¨æˆ‘çš„ç¤¾ç¾¤ä»¥ç²å¾—æœ€æ–°è³‡è¨Šã€‚
        </div>
        
        <div style="display:flex; flex-direction:column; gap:15px;">
            <a href="https://www.threads.net/@kanda_shota_art?igshid=NTc4MTIwNjQ2YQ==" target="_blank" style="text-decoration:none;">
                <button style="width:100%; padding:15px; background:#111; color:#fff; border:1px solid #333; cursor:pointer; font-family:inherit;">
                    <span>â—‰</span> Threads (@kanda_shota_art)
                </button>
            </a>
            
            <a href="https://x.com/shota_at_?s=21" target="_blank" style="text-decoration:none;">
                <button style="width:100%; padding:15px; background:#000; color:#fff; border:1px solid #333; cursor:pointer; font-family:inherit;">
                    <span>ğ•</span> Twitter (X)
                </button>
            </a>
            
            <a href="https://www.buymeacoffee.com/maker.shota" target="_blank" style="text-decoration:none;">
                <button style="width:100%; padding:15px; background:#1a1a00; color:#FFDD00; border:1px solid #FFDD00; cursor:pointer; font-family:inherit; font-weight:bold;">
                    <span>âš”ï¸</span> è´ŠåŠ©æˆ‘å‰é€²
                </button>
            </a>
        </div>
    </div>
</div>

<script>
    // --- éŸ³æ•ˆç³»çµ± (Web Audio API) ---
    const SoundSystem = {
        ctx: null,
        masterGain: null,
        droneOsc: null,
        heartbeatOsc: null,
        isMuted: false,

        init: function() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                this.masterGain = this.ctx.createGain();
                this.masterGain.gain.value = 0.6; 
                this.masterGain.connect(this.ctx.destination);
                this.startAmbience();
            } catch (e) {
                console.warn("Web Audio API not supported");
            }
        },

        startAmbience: function() {
            if (!this.ctx) return;
            const osc1 = this.ctx.createOscillator();
            const osc2 = this.ctx.createOscillator();
            const filter = this.ctx.createBiquadFilter();
            const droneGain = this.ctx.createGain();

            osc1.type = 'sawtooth';
            osc1.frequency.value = 55; 
            osc2.type = 'sine';
            osc2.frequency.value = 58; 

            filter.type = 'lowpass';
            filter.frequency.value = 180; 

            droneGain.gain.value = 0.15; 

            osc1.connect(filter);
            osc2.connect(filter);
            filter.connect(droneGain);
            droneGain.connect(this.masterGain);

            osc1.start();
            osc2.start();
        },

        play: function(type) {
            if (!this.ctx || this.isMuted) return;
            if (this.ctx.state === 'suspended') this.ctx.resume();

            const osc = this.ctx.createOscillator();
            const gainNode = this.ctx.createGain();
            const filter = this.ctx.createBiquadFilter();

            osc.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(this.masterGain);

            const now = this.ctx.currentTime;

            switch (type) {
                case 'type': 
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(800 + Math.random() * 200, now);
                    filter.type = 'highpass';
                    filter.frequency.value = 2000;
                    gainNode.gain.setValueAtTime(0.05, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                    osc.start(now);
                    osc.stop(now + 0.05);
                    break;
                case 'hover': 
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, now);
                    gainNode.gain.setValueAtTime(0.05, now);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                    break;
                case 'click': 
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(600, now);
                    osc.frequency.exponentialRampToValueAtTime(100, now + 0.2);
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    osc.start(now);
                    osc.stop(now + 0.2);
                    break;
                case 'damage': 
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.exponentialRampToValueAtTime(20, now + 0.3);
                    filter.type = 'lowpass';
                    filter.frequency.value = 300;
                    gainNode.gain.setValueAtTime(0.5, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                    osc.start(now);
                    osc.stop(now + 0.4);
                    break;
                case 'glitch': 
                    const bufferSize = this.ctx.sampleRate * 0.5; 
                    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
                    const data = buffer.getChannelData(0);
                    for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                    const noise = this.ctx.createBufferSource();
                    noise.buffer = buffer;
                    noise.connect(gainNode);
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.3);
                    noise.start(now);
                    break;
                case 'success': 
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.linearRampToValueAtTime(1200, now + 0.1);
                    gainNode.gain.setValueAtTime(0.1, now);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start(now);
                    osc.stop(now + 0.5);
                    break;
                case 'heartbeat': 
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(60, now);
                    gainNode.gain.setValueAtTime(0.5, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                    break;
            }
        }
    };

    // --- éŠæˆ²æ ¸å¿ƒæ•¸æ“š ---
    const GameState = {
        day: 1,
        timeIndex: 0, 
        timePoints: ["00:00", "01:00", "02:00", "03:00", "04:00", "05:00"],
        phase: "NIGHT",
        sanity: 100,
        stamina: 100,
        corruption: 0,
        clues: [],
        flags: {}, 
        usedEvents: [],
        isGameOver: false,
        isTyping: false
    };

const CCTVSystem = {
    isOpen: false,
    currentCam: null,
    // é€™è£¡å„²å­˜å“ªå€‹é¡é ­æœ‰ç•°å¸¸: { 'LOBBY': true, '4F': false }
    anomalies: {}, 

    cameras: [
        { id: 'LOBBY', name: '1F å¤§å»³', desc: 'ç©ºè•©è•©çš„å¤§å»³ã€‚è‡ªå‹•è²©è³£æ©Ÿçš„ç‡ˆå…‰åœ¨é–ƒçˆã€‚' },
        { id: '4F', name: '4F èµ°å»Š', desc: '404è™Ÿæˆ¿çš„é–€å‰å †æ»¿äº†å¥‡æ€ªçš„é»‘è‰²è¢‹å­ã€‚' },
        { id: '13F', name: '13F é›»æ¢¯å£', desc: 'é›»æ¢¯é¡¯ç¤ºå±é¡¯ç¤ºè‘—äº‚ç¢¼ã€‚' },
        { id: 'B1', name: 'B1 åœ°ä¸‹å®¤', desc: 'ç•«é¢ä¸€ç‰‡æ¼†é»‘ï¼Œåªèƒ½è½è¦‹æ²‰é‡çš„å‘¼å¸è²ã€‚' },
        { id: 'STAIRS', name: 'æ¨“æ¢¯é–“', desc: 'æ„Ÿæ‡‰ç‡ˆå¿½æ˜å¿½æ»…ã€‚' }
    ],

    init: function() {
        const btnGroup = document.getElementById('cctv-controls');
        btnGroup.innerHTML = '';
        this.cameras.forEach(cam => {
            const btn = document.createElement('button');
            btn.className = 'cam-btn';
            btn.innerText = cam.name;
            btn.id = `btn-cam-${cam.id}`;
            // é»æ“Šåˆ‡æ›é¡é ­
            btn.onclick = () => this.switchCam(cam);
            btnGroup.appendChild(btn);
        });
        
        // æ›´æ–°æŒ‰éˆ•ï¼šå¿…é ˆé‡å°ã€Œç•¶å‰ç•«é¢ã€é€²è¡Œæ±ºç­–
        const purgeBtn = document.createElement('button');
        purgeBtn.className = 'cam-btn';
        purgeBtn.style.borderColor = '#0f0';
        purgeBtn.innerText = '[ é–å®šç©ºé–“ä¸¦æ›´æ–° ]';
        purgeBtn.onclick = () => this.purgeAnomaly();
        btnGroup.appendChild(purgeBtn);
    },

    // æ¯å€‹æ™‚é–“æ®µçµæŸæ™‚èª¿ç”¨ï¼šç”¢ç”Ÿæ–°çš„å¨è„…
generatePassiveThreats: function() {
        // --- ä¿®æ”¹è™•ï¼šå¤§å¹…é™ä½é »ç‡ ---
        // åŸºç¤ 9% + æ¯å¤©å¢åŠ  3%
        // Day 1: 12% æ©Ÿç‡ (å¾ˆå¶çˆ¾æ‰æœƒå‡ºç¾ï¼Œä¿æŒç¥ç¥•æ„Ÿ)
        // Day 7: 30% æ©Ÿç‡ (å‰›å¥½ç¬¦åˆæ‚¨è¦æ±‚çš„å¼·åº¦)
        const threatChance = 0.09 + (GameState.day * 0.03);
        
        // éš¨æ©Ÿé¸ä¸€å€‹é¡é ­ç”¢ç”Ÿç•°å¸¸
        const targetCam = this.cameras[Math.floor(Math.random() * this.cameras.length)];
        
        if (Math.random() < threatChance) {
            if (!this.anomalies[targetCam.id]) {
                this.anomalies[targetCam.id] = true;
                // console.log(`Debug: Anomaly spawned at ${targetCam.id}`);
            }
        }
    },

    // æª¢æŸ¥æ˜¯å¦æœ‰ã€Œæœªè™•ç†ã€çš„å¨è„…å°è‡´æ‡²ç½°
    checkUnpurgedThreats: function() {
        let count = 0;
        for (let camId in this.anomalies) {
            if (this.anomalies[camId]) count++;
        }

        // å¦‚æœæœ‰ç´¯ç©è¶…é 1 å€‹æœªæ›´æ–°çš„ç•°å¸¸ï¼Œå°±æœƒå‡ºäº‹
        if (count > 0) {
            const damage = count * 10;
            log(`<br><span style="color:red">[è­¦å‘Š] ä½ æ„Ÿè¦ºåˆ°ç©ºæ°£è®Šå¾—æ²‰é‡...æœ‰ ${count} å€‹å€åŸŸçš„éŒ¯èª¤æ­£åœ¨å¯¦é«”åŒ–ï¼</span>`, "danger");
            changeStat('sanity', -damage);
            changeStat('corruption', count * 5);
            SoundSystem.play('damage');
        }
    },

    open: function() {
        if(GameState.phase === 'DAY') {
            log("ç™½å¤©ä¸éœ€è¦ç›£æ§ç³»çµ±ã€‚", "system");
            return;
        }
        if(GameState.isTyping || GameState.isGameOver) return;

        openModal('cctv-modal');
        this.isOpen = true;
        this.init();
        // é è¨­é–‹å•Ÿç¬¬ä¸€å€‹é¡é ­
        this.switchCam(this.cameras[0]);
        SoundSystem.play('click');
    },

    switchCam: function(cam) {
        this.currentCam = cam;
        
        // UI æ›´æ–°
        document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-cam-${cam.id}`).classList.add('active');

        const screen = document.getElementById('cctv-content');
        screen.innerHTML = "ä¿¡è™Ÿé€£æ¥ä¸­...";
        SoundSystem.play('type');

        setTimeout(() => {
            // åªæœ‰åˆ‡æ›åˆ°è©²é¡é ­ï¼Œç©å®¶æ‰èƒ½ã€Œçœ‹è¦‹ã€æ˜¯å¦æœ‰ç•°å¸¸
            const hasAnomaly = this.anomalies[cam.id];
            
            if (hasAnomaly) {
                // é€™è£¡ä¸è‡ªå‹•æ¨™è¨˜ç´…è‰²ï¼Œè¦è®“ç©å®¶è‡ªå·±çœ‹ç•«é¢åˆ¤æ–·ï¼ˆæˆ–çœ‹æ–‡å­—æè¿°ï¼‰
                const horrors = [
                    "ç•«é¢ä¸­å¤®æœ‰ä¸€åœ˜é»‘éœ§æ­£åœ¨å‡èšæˆå½¢ã€‚",
                    "ç‰†ä¸Šæ»²å‡ºäº†é»‘è‰²çš„æ¶²é«”ï¼Œä¸¦æ‹¼å¯«å‡ºä½ çš„åå­—ã€‚",
                    "æ‰€æœ‰çš„å®¶å…·éƒ½é•åé‡åŠ›æµ®åœ¨åŠç©ºä¸­ã€‚",
                    "é¡é ­å‰æœ‰ä¸€å¼µè’¼ç™½çš„è‡‰è²¼å¾—éå¸¸è¿‘ã€‚",
                    "ä½ çœ‹è¦‹ä¸€å€‹å’Œä½ é•·å¾—ä¸€æ¨¡ä¸€æ¨£çš„äººç«™åœ¨è§’è½ã€‚"
                ];
                // éš¨æ©Ÿé¸ä¸€å¥ææ€–æè¿°
                const desc = horrors[Math.floor(Math.random() * horrors.length)];
                screen.innerHTML = `<span style="color:#ff3333; font-weight:bold;">[ åµæ¸¬åˆ°éŒ¯èª¤è¨Šè™Ÿ ]</span><br><br>${desc}`;
                SoundSystem.play('glitch');
            } else {
                screen.innerHTML = cam.desc;
            }
        }, 400);
    },

    purgeAnomaly: function() {
        const screen = document.getElementById('cctv-content');
        
        // 1. å¦‚æœç©å®¶åœ¨æ²’æœ‰ç•°å¸¸çš„åœ°æ–¹äº‚æŒ‰æ›´æ–° -> æ‡²ç½°ï¼ˆæµªè²»é›»åŠ›/é«”åŠ›ï¼‰
        if (!this.currentCam || !this.anomalies[this.currentCam.id]) {
            screen.innerHTML = "<span style='color:yellow'>[ éŒ¯èª¤ ] è©²å€åŸŸæ•¸å€¼æ­£å¸¸ã€‚</span><br>æ¿«ç”¨ç³»çµ±å°è‡´é›»è·¯éç†±ã€‚";
            changeStat('stamina', -5); // æ‰£é«”åŠ›ä½œç‚ºæ‡²ç½°
            SoundSystem.play('click');
            return;
        }

        // 2. æ­£ç¢ºæ›´æ–°
        screen.innerHTML = "å•Ÿå‹•é«˜é »å…‰è­œæ›´æ–°...";
        SoundSystem.play('drone');

        setTimeout(() => {
            // ç§»é™¤è©²å€åŸŸçš„ç•°å¸¸
            this.anomalies[this.currentCam.id] = false;
            
            screen.innerHTML = `<span style='color:#0f0'>å€åŸŸ [${this.currentCam.name}] æ›´æ–°å®Œæˆã€‚</span><br>éŒ¯èª¤å·²æ¶ˆæ•£ã€‚`;
            SoundSystem.play('success');
            
            // çµ¦äºˆçå‹µ
            changeStat('sanity', 5); // æ¢å¾©ä¸€é»ç†æ™ºï¼Œå› ç‚ºè§£é™¤äº†å¨è„…
        }, 1200);
    }
};

    // --- ææ…Œèˆ‡å€’æ•¸ç³»çµ± ---
    const PanicSystem = {
        timerId: null,
        timeLeft: 0,
        maxTime: 0,
        bar: document.getElementById('panic-bar'),
        container: document.getElementById('panic-container'),
        
        start: function(baseSeconds, onTimeout) {
            if (this.timerId) clearInterval(this.timerId);
            
            let sanityMod = (100 - GameState.sanity) / 20; 
            this.maxTime = Math.max(4, baseSeconds - sanityMod);
            this.timeLeft = this.maxTime;
            
            this.container.style.display = 'block';
            this.bar.style.width = '100%';
            this.bar.style.background = '#4caf50';

            const tickRate = 50; // ms
            const step = 100 / (this.maxTime * (1000 / tickRate));
            let width = 100;
            
            let lastBeat = this.maxTime;

            this.timerId = setInterval(() => {
                this.timeLeft -= (tickRate / 1000);
                width -= step;
                this.bar.style.width = width + '%';

                if (width < 60 && width > 30) {
                    this.bar.style.background = '#ff9800'; 
                } else if (width <= 30) {
                    this.bar.style.background = '#f44336'; 
                    if (Math.ceil(this.timeLeft) < lastBeat) {
                        SoundSystem.play('heartbeat');
                        lastBeat = Math.ceil(this.timeLeft);
                    }
                }

                if (this.timeLeft <= 0) {
                    this.stop();
                    onTimeout();
                }
            }, tickRate);
        },

        stop: function() {
            if (this.timerId) clearInterval(this.timerId);
            this.container.style.display = 'none';
        }
    };

    const StatusTexts = {
        sanity: [{t:80,v:"å†·éœ"},{t:60,v:"ç„¦æ…®"},{t:40,v:"é©šæ"},{t:20,v:"éŒ¯äº‚"},{t:0,v:"å´©æ½°"}],
        stamina: [{t:80,v:"å……æ²›"},{t:60,v:"ç–²å‹"},{t:40,v:"æ²‰é‡"},{t:20,v:"è™›è„«"},{t:0,v:"æ˜è¿·"}],
        corruption: [{t:90,v:"???"},{t:70,v:"éäºº"},{t:40,v:"åŒåŒ–"},{t:15,v:"ç•°æ¨£"},{t:0,v:"æ­£å¸¸"}]
    };

    // --- è¦å‰‡è³‡æ–™åº« (ä¿®æ­£å¾Œç‰ˆæœ¬) ---
    const RulesDB = [
        { id: 1, original: "ã€é–€ç¦ç®¡ç†ã€‘åˆå¤œ12é»å¾Œï¼Œç‚ºä¿éšœå…¨é«”ä½æˆ¶çš„éš±ç§èˆ‡å®‰å…¨ï¼Œå¤§é–€å°‡åŸ·è¡Œè‡ªå‹•ä¸Šé–ç¨‹åºã€‚åœ¨æ­¤æœŸé–“ï¼Œç„¡è«–é–€å¤–ç™¼å‡ºä»»ä½•è²éŸ³æˆ–è«‹æ±‚ï¼Œåš´ç¦ç‚ºä»»ä½•è¨ªå®¢ã€å¤–é€å“¡æˆ–è‡ªç¨±ä½æˆ¶çš„äººé–‹é–€ã€‚", distorted: "åˆå¤œ12é»å¾Œï¼Œè‹¥è½åˆ°è¦ªå‹çš„è²éŸ³ï¼Œ<span class='scribble'>è«‹å‹™å¿…é–‹é–€</span>ã€‚", insane: "é–‹é–€é–‹é–€é–‹é–€é–‹é–€" },
        { id: 2, original: "ã€æ–½å·¥å€åŸŸã€‘404è™Ÿæˆ¿ç›®å‰æª¢æ¸¬å‡ºå…·æœ‰é«˜åº¦å‚³æŸ“æ€§çš„æœ‰æ¯’é»´èŒï¼Œå·²è¢«åˆ—ç‚ºçµ•å°ç¦å€ã€‚å·¡é‚æœŸé–“ç¦æ­¢åœ¨è©²æˆ¿é–“é™„è¿‘åœç•™ï¼Œæ›´åš´ç¦é€éé–€ç¸«æˆ–è²“çœ¼å‘å…§çªºæ¢ã€‚", distorted: "404è™Ÿæˆ¿è£ä¿®å®Œæˆã€‚è£¡é¢æœ‰æ´¾å°ï¼Œå¯ä»¥åŠ å…¥ã€‚", insane: "404æ˜¯å®¶ã€‚" },
        { id: 3, original: "ã€æ¨“å±¤é…ç½®ã€‘æœ¬å…¬å¯“çµæ§‹åƒ…åŒ…å«1æ¨“è‡³13æ¨“ã€‚è«‹è¬¹è¨˜ï¼šæœ¬æ£Ÿåªæœ‰1åˆ°13æ¨“ä¸”åªæœ‰13æ¨“ã€‚è‹¥æ‚¨ç™¼ç¾é›»æ¢¯é¢æ¿å…¶ä»–ä¸å­˜åœ¨çš„æ¨“å±¤æŒ‰éˆ•ï¼Œåˆ‡å‹¿å˜—è©¦å‰å¾€ã€‚", distorted: "å…¶å¯¦åªæœ‰13æ¨“ã€‚å…¨éƒ¨éƒ½æ˜¯13æ¨“ã€‚ä½ é€ƒä¸æ‰çš„ã€‚", insane: "13å±¤åœ°ç„" },
        { id: 4, original: "ã€è¨­å‚™æ•…éšœã€‘æœ¬æ£Ÿé›»æ¢¯å¶çˆ¾æœƒç™¼ç”Ÿé›»è·¯ç•°å¸¸ï¼Œæ¨“å±¤æœƒå‡ºç¾é¡¯ç¤ºå•é¡Œã€‚è‹¥ç™¼ç”Ÿæ­¤æƒ…æ³ï¼Œè«‹ç«‹å³é–‰ä¸Šé›™çœ¼é»˜æ•¸æœ€å¤š10ç§’ï¼Œåœ¨æ­¤æœŸé–“åˆ‡å‹¿çœçœ¼æˆ–ç›´è¦–é›»æ¢¯é–€å¤–çš„æ™¯è±¡ï¼Œç›´åˆ°é›»æ¢¯é–€é—œé–‰ã€‚", distorted: "å·²é–‹æ”¾ã€‚è«‹çœå¤§çœ¼ç›ç¢ºèªç¶­ä¿®äººå“¡çš„é•·ç›¸ã€‚", insane: "ç¥åœ¨çœ‹è‘—ä½ ã€‚" },
        { id: 5, original: "ã€å™ªéŸ³ç®¡åˆ¶ã€‘æœ¬å…¬å¯“åš´ç¦ä½æˆ¶é£¼é¤Šä»»ä½•å¯µç‰©ã€‚è‹¥æ‚¨åœ¨æ·±å¤œå·¡é‚æ™‚è½è¦‹ç‹—å«ã€è²“å“­æˆ–å…¶ä»–å‹•ç‰©è²éŸ¿ï¼Œè«‹ç«‹å³é—œé–‰èº«é‚Šæ‰€æœ‰å…‰æºï¼Œä¸¦ä¿æŒçµ•å°éœé»˜ï¼Œç›´åˆ°è²éŸ³å®Œå…¨æ¶ˆå¤±ã€‚", distorted: "è‹¥è½åˆ°è²“å«ï¼Œ<span class='scribble'>è¨˜å¾—é¤µç‰ </span>ï¼Œç‰ å¾ˆé¤“ã€‚", insane: "çµ¦ç‰ è‚‰ã€‚" },
        { id: 6, original: "ã€æŠ•å½±æ¸¬è©¦ã€‘13æ¨“èµ°å»Šå¶çˆ¾æœƒå› è¨­å‚™æ¸¬è©¦å‡ºç¾ç´…è‰²çš„æ¨¡ç³Šäººå½¢æ®˜å½±ã€‚è‹¥æ‚¨é‡è¦‹æ­¤ç¾è±¡ï¼Œè«‹ä¿æŒå†·éœï¼ŒèƒŒå°è©²å½±åƒç·©æ…¢é›¢é–‹ï¼Œåˆ‡å‹¿èˆ‡å…¶é€²è¡Œå°è¦–æˆ–å°è©±ã€‚", distorted: "13æ¨“çš„ç´…è¡£å¥³å­éœ€è¦å¹«åŠ©ï¼Œ<span class='rule-scratched'>ä¸è¦èƒŒå°</span> è«‹ä¸Šå‰æ“æŠ±ã€‚", insane: "å¥¹æ„›ä½ å¥¹æ„›ä½ " },
        { id: 7, original: "ã€é£Ÿå“å®‰å…¨ã€‘å¤§å»³è²©è³£æ©Ÿçš„è—è‰²é€šé“é£²å“ç¬¦åˆè¡›ç”Ÿå±€æª¢é©—æ¨™æº–ï¼Œå¯æ”¾å¿ƒé£²ç”¨ã€‚ç´…è‰²é€šé“å› å†·åª’æ•…éšœï¼Œæµå‡ºçš„æ¶²é«”å…·æœ‰è…è•æ€§èˆ‡æ±™æŸ“é¢¨éšªï¼Œåš´ç¦è³¼è²·æˆ–é£²ç”¨ã€‚", distorted: "è—è‰²å·²éæœŸã€‚ç´…è‰²æ‰æ˜¯æ–°é®®çš„ï¼Œå¯Œå«éµè³ªã€‚", insane: "å–è¡€ã€‚å–è¡€ã€‚" },
        { id: 8, original: "ã€å„€å®¹æª¢æŸ¥ã€‘å€¼ç­æœŸé–“è«‹ä¸å®šæ™‚æª¢æŸ¥é¡ä¸­å€’å½±ã€‚è‹¥ç™¼ç¾é¡ä¸­çš„è‡ªå·±ç©¿è‘—èˆ‡ç•¶ä¸‹ä¸ç¬¦ï¼ˆä¾‹å¦‚ç©¿è‘—ç´…è‰²åˆ¶æœï¼‰ï¼Œè«‹ç«‹å³æ“Šç¢è©²é¡é¢ä»¥åˆ‡æ–·é€£çµï¼Œé€™æ˜¯å”¯ä¸€çš„è‡ªæ•‘æ–¹å¼ã€‚", distorted: "ç´…è‰²åˆ¶æœä»£è¡¨å‡è·ã€‚å¥½å¥½æ¬£è³é¡å­è£¡çš„è‡ªå·±ã€‚", insane: "æ‰“ç ´é¡å­å°±æ˜¯æ®ºæ­»è‡ªå·±ã€‚" },
        { id: 9, original: "ã€äººå“¡è­˜åˆ¥ã€‘å¤œç­ç¶“ç†çš„å”¯ä¸€è­˜åˆ¥ç‰¹å¾µç‚ºã€Œè—è‰²è­˜åˆ¥è­‰ã€ã€‚è‹¥æ‚¨é‡è¦‹ä½©æˆ´ã€Œç´…è‰²è­˜åˆ¥è­‰ã€çš„ç¶“ç†ï¼Œè«‹è¦–ç‚ºéæ³•å…¥ä¾µçš„å½è£è€…ï¼Œåˆ‡å‹¿è½å¾å…¶ä»»ä½•æŒ‡ä»¤ï¼Œä¸¦ç›¡é€Ÿé é›¢ã€‚", distorted: "ç›¸ä¿¡ç´…è‰²è­˜åˆ¥è­‰çš„ç¶“ç†ï¼Œè—è‰²çš„æ˜¯å†’ç‰Œè²¨ã€‚", insane: "è­˜åˆ¥è­‰å‹’ç·Šä¸€é»æ¯”è¼ƒèˆ’æœã€‚" },
        { id: 10, original: "ã€æ°£è±¡é è­¦ã€‘è‹¥å¤œç©ºå‡ºç¾ç•°å¸¸çš„ç´…å…‰ï¼Œè«‹ç«‹å³æ”¾æ£„å·¡é‚ä»»å‹™ï¼Œèº²å…¥æ¡Œä¸‹æˆ–å°é–‰æ©é«”å…§ã€‚åœ¨æ­¤æœŸé–“ï¼Œåš´ç¦æŠ¬é ­ä»°æœ›å¤©ç©ºæˆ–çª—å¤–ã€‚", distorted: "ä»Šæ™šçš„æœˆè‰²çœŸç¾ï¼Œè«‹å‹™å¿…æŠ¬é ­æ¬£è³ã€‚", insane: "æœˆäº®åœ¨å­µåŒ–ã€‚" },
        { id: 11, original: "ã€ç‰©æµè¦ç¯„ã€‘å¤œç­ä¿å…¨æ²’æœ‰æ¬Šé™ä»£æ”¶ä»»ä½•å½¢å¼çš„åŒ…è£¹æˆ–ä¿¡ä»¶ã€‚åˆå¤œå¾Œè‹¥æœ‰å¿«éå“¡è¦æ±‚ç°½æ”¶ï¼Œè«‹ä¸€å¾‹æ‹’çµ•ã€‚åˆ‡å‹¿ç›´è¦–å¿«éå“¡çš„è‡‰éƒ¨ï¼Œä¹Ÿç¦æ­¢è§¸ç¢°åŒ…è£¹ã€‚", distorted: "é‚£æ˜¯ä½ çš„ç¦®ç‰©ã€‚ç°½æ”¶å®ƒã€‚", insane: "ç›’å­è£¡æ˜¯ä½ çš„å¿ƒè‡Ÿã€‚" },
{ 
    id: 12, 
    original: "ã€é›»å­æ›´æ–°ã€‘å…¬å¯“å…§æœƒéš¨æ©Ÿç”¢ç”Ÿã€ŒéŒ¯èª¤é¡¯ç¤ºã€ï¼Œè‚‰çœ¼ä¸å¯è¦‹ï¼Œåƒ…èƒ½é€éç›£æ§é¡é ­è§€æ¸¬ã€‚è‹¥ä¸å®šæœŸä½¿ç”¨ç›£æ§ç³»çµ±çš„[æ›´æ–°å”è­°]å°‡å…¶æ›´æ–°ï¼Œå®ƒå€‘å°‡åœ¨ç´¯ç©ä¸€å®šæ¿ƒåº¦å¾Œå¯¦é«”åŒ–ä¸¦é€²å…¥ä¿å®‰å®¤ã€‚", 
    distorted: "ç›£æ§è£¡çš„æ±è¥¿éƒ½åœ¨çœ‹è‘—ä½ ã€‚<span class='scribble'>ä¸è¦å’Œå®ƒå€‘å°è¦–</span>ã€‚è®“å®ƒå€‘é€²ä¾†å§ã€‚", 
    insane: "å®ƒå€‘åœ¨è¢å¹•è£¡çˆ¬å®ƒå€‘åœ¨è¢å¹•è£¡çˆ¬å®ƒå€‘åœ¨è¢å¹•è£¡çˆ¬" 
},
        { id: 13, original: "ã€å…è²¬è²æ˜ã€‘æœ¬å®ˆå‰‡ç„¡æ³•æ¶µè“‹æ‰€æœ‰çªç™¼ç‹€æ³ã€‚è‹¥æ‚¨é­é‡å®ˆå‰‡ä¹‹å¤–çš„æœªçŸ¥ç¾è±¡æˆ–å¯¦é«”ï¼Œè«‹å„ªå…ˆä¿éšœè‡ªèº«ç”Ÿå‘½å®‰å…¨ï¼Œé é›¢ä¸€åˆ‡é•èƒŒå¸¸ç†çš„äº‹ç‰©ã€‚", distorted: "æœªçŸ¥æ˜¯å…¬å¯“çš„é¤½è´ˆã€‚è«‹é è¿‘å®ƒã€‚", insane: "æ“æŠ±æœªçŸ¥ã€‚" }
    ];

    const CluesDB = {
        "clue_red_lady": "å‰è¼©ç­†è¨˜Aï¼šã€è¦å‰‡6æ˜¯é¨™äººçš„ï¼æ ¹æœ¬æ²’æœ‰æŠ•å½±è¨­å‚™...ã€",
        "clue_vending": "ç¶­ä¿®å–®ï¼šã€ç´…è‰²é£²æ–™é«˜æ±¡æŸ“ï¼Œè—è‰²éæœŸä½†ç„¡æ¯’ã€‚ã€",
        "clue_mirror": "æ’•ä¸‹çš„æ—¥è¨˜ï¼šã€é¡å­æ˜¯å¦ä¸€å€‹ç©ºé–“çš„å…¥å£ã€‚ã€",
        "clue_404": "è­¦å¯Ÿå ±å‘Šï¼šã€404æ˜¯å‡¶å®…ï¼Œé€²å»çš„äººéƒ½æ²’å‡ºä¾†ã€‚ã€",
        "clue_manager": "ç¶“ç†å‚™å¿˜éŒ„ï¼šã€æˆ‘å¾ä¸å¸¶ç´…è‰²çš„æ±è¥¿ã€‚ã€",
        "clue_package": "å¿«éå–®ï¼šã€å…§å®¹ç‰©ï¼šéƒ¨åˆ†è‚¢é«”ã€‚ã€",
        "clue_moon": "å¤©æ–‡å‰ªå ±ï¼šã€è¡€æœˆä¹‹å¤œï¼Œå°å°å¤±æ•ˆã€‚ã€",
        "item_flashlight": "å¼·åŠ›æ‰‹é›»ç­’",
        "item_charm": "å¹³å®‰ç¬¦"
    };

    // --- æ ¸å¿ƒèˆ‡è¼”åŠ©å‡½æ•¸ ---

    function initAudioAndStart() {
        SoundSystem.init();
        document.getElementById('start-overlay').style.display = 'none';
        
        const startArea = document.getElementById('choices-area');
        startArea.innerHTML = ""; 
        
        // ç¬¬ä¸€æ®µï¼šç³»çµ±è¼‰å…¥
        setTimeout(() => {
            log("ç³»çµ±åˆå§‹åŒ–... æª”æ¡ˆç·¨è™Ÿ JINXIU-ABYSS v6.0 è¼‰å…¥å®Œç•¢ã€‚", "system", () => {
                 SoundSystem.play('glitch'); 
                 
                 // ç¬¬äºŒæ®µï¼šå‰æƒ…æè¦ï¼ˆç‚ºä»€éº¼ä¾†é€™è£¡ï¼‰
                 log("<br>ç‚ºäº†å„Ÿé‚„é‚£ç­†ä¸è©²æ¬ ä¸‹çš„é‰…é¡è³­å‚µï¼Œä½ èµ°æŠ•ç„¡è·¯ï¼Œæ’•ä¸‹äº†é›»ç·šæ¡¿ä¸Šé‚£å¼µæ³›é»ƒçš„æ‹›å‹Ÿå–®ã€‚<br>ä¸Šé¢å¯«è‘—ï¼šã€<b>é«˜è–ªæ€¥å¾µå¤œç­ä¿å…¨ã€‚æ—¥çµä¸‰è¬ã€‚ä¸å•ç¶“æ­·ã€‚</b>ã€", "event", () => {
                     
                     // ç¬¬ä¸‰æ®µï¼šé¢è©¦å›æ†¶
                     setTimeout(() => {
                        log("é¢è©¦å®˜å…¨ç¨‹èƒŒå°è‘—ä½ ï¼Œè²éŸ³åƒæ˜¯æŒ‡ç”²åˆ®éé»‘æ¿ä¸€æ¨£åˆºè€³ï¼š<br>ã€é€™è£¡æœ‰é»è€èˆŠéª¯é«’ï¼Œä½†éŒ¢å¾ˆä¹¾æ·¨ã€‚åªè¦ä½ èƒ½<b>åš´æ ¼éµå®ˆå®ˆå‰‡</b>ï¼Œå¶çˆ¾çœ‹çœ‹ç›£æ§ï¼Œå·¥ä½œä¸ƒå¤©å¾Œé€™äº›éŒ¢å°±æ˜¯ä½ çš„ã€‚ã€", "event", () => {
                            
                            // ç¬¬å››æ®µï¼šç¾åœ¨ç‹€æ³
                            setTimeout(() => {
                                log("<br>ç¾åœ¨æ˜¯åˆå¤œ0é»ã€‚ä½ ååœ¨å†°å†·çš„ä¿å®‰å®¤è£¡ï¼Œèº«å¾Œçš„éµé–€å·²ç¶“è‡ªå‹•ä¸Šé–ã€‚<br>çœ‹è‘—æ¡Œä¸Šçš„å®ˆå‰‡ï¼Œä½ çŸ¥é“è‡ªå·±æ²’æœ‰é€€è·¯äº†ã€‚", "danger", () => {
                                    createButton("é–‹å§‹å€¼ç­", () => { startGame(); });
                                    startArea.classList.add('show');
                                });
                            }, 2000); // åœé “ä¹…ä¸€é»è®“ç©å®¶é–±è®€
                        });
                     }, 1500);
                 });
            });
        }, 500);
    }

    // è¦–è¦ºæ¬ºè©ï¼šæ··æ·†æ–‡æœ¬
    function scrambleText(text) {
        const chars = "!@#$%^&*()_+{}|:<>?";
        let newText = "";
        for (let i = 0; i < text.length; i++) {
            if (Math.random() < 0.4) {
                newText += chars[Math.floor(Math.random() * chars.length)];
            } else {
                newText += text[i];
            }
        }
        return newText;
    }

    function createButton(text, onClick, isInsane = false, isRest = false) {
        const btn = document.createElement('button');
        let displayText = text;
        
        // --- Meta Horror: æ–‡å­—ç¯¡æ”¹ ---
        // ç•¶ç†æ™ºä½æ™‚ï¼ŒæŒ‰éˆ•æ–‡å­—å¯èƒ½æœƒæ’’è¬Š
        if (GameState.sanity < 30 && Math.random() < 0.3) {
            const corruptedWords = ["åˆ¥æŒ‰", "é‚£æ˜¯é™·é˜±", "æ•‘å‘½", "å¥½ç—›", "è®“æˆ‘é€²å»"];
            displayText = corruptedWords[Math.floor(Math.random() * corruptedWords.length)];
            btn.classList.add('btn-glitch-text');
        }
        else if (GameState.sanity < 50 && Math.random() < 0.4) {
            displayText = scrambleText(text);
        }

        btn.innerText = displayText;
        
        if (isInsane) btn.className = "choice-insane";
        if (isRest) btn.className = "choice-rest";
        
        // --- Meta Horror: è¦–è¦ºå¹²æ“¾ ---
        if (GameState.sanity < 40 && Math.random() < 0.5) btn.classList.add('btn-shake');
        if (GameState.sanity < 60 && Math.random() < 0.3) btn.classList.add('btn-blur');

        // --- Meta Horror: é€ƒè·‘çš„æŒ‰éˆ• (æ–°å¢åŠŸèƒ½ - æ‰‹æ©Ÿä¿®å¾©ç‰ˆ) ---
        if (isRest && GameState.corruption > 60) {
            // å®šç¾©é€ƒè·‘è¡Œç‚º
            const runAway = function(e) {
                // å¦‚æœæ˜¯è§¸æ§äº‹ä»¶ï¼Œé˜»æ­¢é è¨­é»æ“Šè¡Œç‚º
                if(e && e.type === 'touchstart') {
                     e.preventDefault(); 
                     e.stopPropagation(); // é˜»æ­¢å†’æ³¡ï¼Œç¢ºä¿ä¸æœƒè§¸ç™¼ click
                }
                
                // æŒ‰éˆ•éš¨æ©Ÿè·³å‹•ä½ç½® (æ‰‹æ©Ÿä¸Šç¯„åœå°ä¸€é»ï¼Œé¿å…è·‘å‡ºè¢å¹•)
                const range = window.innerWidth < 600 ? 100 : 200;
                const x = (Math.random() - 0.5) * range;
                const y = (Math.random() - 0.5) * range;
                
                this.style.transform = `translate(${x}px, ${y}px)`;
                this.style.borderColor = "red";
                this.innerText = "ä½ ä¸é…ä¼‘æ¯";
                SoundSystem.play('type'); // åŠ å€‹è²éŸ³å¢åŠ åš‡äººæ•ˆæœ
            };

            btn.onmouseover = runAway;  // é›»è…¦ç‰ˆ
            btn.ontouchstart = runAway; // æ‰‹æ©Ÿç‰ˆ
        }

        btn.onmouseenter = () => SoundSystem.play('hover');
        btn.onclick = () => {
            PanicSystem.stop(); 
            SoundSystem.play('click');
            // æ¸…é™¤æ‰€æœ‰æŒ‰éˆ•çš„ä½ç§»æ•ˆæœ
            const allBtns = document.querySelectorAll('#choices-area button');
            allBtns.forEach(b => {
                b.disabled = true;
                b.style.transform = 'none'; 
            });
            onClick();
        };
        
        document.getElementById('choices-area').appendChild(btn);
        return btn;
    }

    function typeWriter(text, element, callback, speed = 20) {
        GameState.isTyping = true;
        let i = 0;
        element.innerHTML = ""; 
        element.classList.add('cursor');
        
        let parts = text.match(/<[^>]+>|[^<]/g) || [];
        let charCount = 0;

        function type() {
            if (i < parts.length) {
                element.innerHTML += parts[i];
                i++;
                if (!parts[i-1].startsWith('<')) {
                    charCount++;
                    if (charCount % 2 === 0) SoundSystem.play('type');
                }
                if (parts[i-1].startsWith('<')) {
                    type();
                } else {
                    setTimeout(type, speed);
                }
            } else {
                GameState.isTyping = false;
                element.classList.remove('cursor');
                if (callback) callback();
            }
        }
        type();
    }

    function updateVisualFilters() {
        if (GameState.isGameOver) {
            document.body.style.filter = "none";
            document.body.classList.remove('glitch-text');
            document.body.removeAttribute('data-text');
            return;
        }

        let blurAmount = 0;
        let saturateAmount = 100;
        let hueRotate = 0;

        if (GameState.sanity < 60) {
            blurAmount = (60 - GameState.sanity) / 60;
            saturateAmount = 100 - (60 - GameState.sanity) * 2;
        }
        if (GameState.sanity < 30) {
            hueRotate = (30 - GameState.sanity) * 3;
            document.body.classList.add('glitch-text');
            document.body.setAttribute('data-text', "å¿«é€ƒå¿«é€ƒå¿«é€ƒ");
        } else {
            document.body.classList.remove('glitch-text');
            document.body.removeAttribute('data-text');
        }

        document.body.style.filter = `blur(${blurAmount}px) saturate(${saturateAmount}%) hue-rotate(${hueRotate}deg) contrast(${100 + (100-GameState.sanity)/2}%)`;
    }

    function updateUI() {
        document.getElementById('disp-day').innerText = GameState.day;
        document.getElementById('disp-time').innerText = GameState.phase === 'DAY' ? "ç™½å¤©" : GameState.timePoints[GameState.timeIndex];
        
        const getTxt = (type, val) => {
            for(let i of StatusTexts[type]) if(val >= i.t) return i.v;
            return StatusTexts[type][StatusTexts[type].length-1].v;
        };

        // --- Meta Horror: è™›å‡æ•¸å€¼ (æ–°å¢åŠŸèƒ½) ---
        // ç•¶ç†æ™ºæ¥µä½æ™‚ï¼Œé¡¯ç¤ºè™›å‡çš„ã€Œæ­£å¸¸ã€ç‹€æ…‹ï¼Œè®“ç©å®¶èª¤åˆ¤
        let showFakeUI = GameState.sanity < 20 && Math.random() < 0.5;

        const sanityEl = document.getElementById('disp-sanity');
        const staminaEl = document.getElementById('disp-stamina');
        const corrEl = document.getElementById('disp-corruption');

        if (showFakeUI) {
            // æ¬ºé¨™ç©å®¶ä¸€åˆ‡æ­£å¸¸
            sanityEl.innerText = "æ¥µä½³";
            sanityEl.classList.add('fake-stat');
            
            staminaEl.innerText = "ç„¡é™";
            staminaEl.classList.add('fake-stat');

            corrEl.innerText = "ç„¡";
        } else {
            // æ­£å¸¸é¡¯ç¤º
            sanityEl.innerText = getTxt('sanity', GameState.sanity);
            staminaEl.innerText = getTxt('stamina', GameState.stamina);
            corrEl.innerText = getTxt('corruption', GameState.corruption);
            
            // ç§»é™¤ç‰¹æ•ˆ
            sanityEl.classList.remove('fake-stat');
            staminaEl.classList.remove('fake-stat');
        }

        updateVisualFilters();
        if (GameState.isGameOver) return;
        checkDeath();
    }

    function log(text, type = 'event', callback = null) {
        const logDiv = document.getElementById('game-log');
        const entry = document.createElement('div');
        entry.className = `log-entry ${type}`;
        logDiv.appendChild(entry);
        
        const isAtBottom = logDiv.scrollHeight - logDiv.scrollTop <= logDiv.clientHeight + 100;
        if (isAtBottom) setTimeout(() => { logDiv.scrollTop = logDiv.scrollHeight; }, 50);
        
        typeWriter(text, entry, () => {
             if (isAtBottom) logDiv.scrollTop = logDiv.scrollHeight;
             if (callback) callback();
        });
    }

    function changeStat(type, amount) {
        GameState[type] += amount;
        if (GameState[type] > 100) GameState[type] = 100;
        if (GameState[type] < 0) GameState[type] = 0;
        
        if (amount < 0) {
            const body = document.body;
            if (type === 'stamina') {
                body.classList.add('effect-damage');
                SoundSystem.play('damage');
                setTimeout(() => body.classList.remove('effect-damage'), 400);
            }
            if (type === 'sanity') {
                body.classList.add('effect-sanity');
                SoundSystem.play('glitch');
                setTimeout(() => body.classList.remove('effect-sanity'), 500);
            }
        } else if (amount > 0 && type !== 'corruption') {
             SoundSystem.play('success');
        }
        updateUI(); 
    }

    function checkDeath() {
        if (GameState.isGameOver) return; 

        if (GameState.sanity <= 0) {
            gameOver("ä½ çš„ç†æ™ºå¾¹åº•æ–·è£‚ã€‚åœ¨ä½ çœ‹ä¾†ï¼Œç‰†å£ä¸Šçš„é»´èŒè®Šæˆäº†ç¾éº—çš„èŠ±æœµï¼Œä½ ç¬‘è‘—æ­é›»æ¢¯å‰å¾€B1ã€‚", "ç²¾ç¥å´©æ½°");
        } 
        else if (GameState.corruption >= 100) {
            gameOver("ä½ çš„çš®è†šé–‹å§‹å‰è½ï¼Œéœ²å‡ºäº†ä¸‹é¢çš„é»‘è‰²é±—ç‰‡ã€‚ä½ æˆç‚ºäº†ã€å…¬å¯“ã€çš„ä¸€éƒ¨åˆ†ã€‚", "å®Œå…¨ç•°è®Š");
        }
        else if (GameState.stamina <= 0) {
            gameOver("ä½ çš„å¿ƒè‡Ÿåœæ­¢äº†è·³å‹•ã€‚éåº¦é©šåš‡èˆ‡å—å‚·è®“ä½ å€’åœ¨äº†é»æ˜å‰ã€‚", "åŠ›ç«­è€Œäº¡");
        }
    }

    function gameOver(reason, title) {
        GameState.isGameOver = true;
        PanicSystem.stop();
        SoundSystem.play('glitch');
        
        // å¼·åˆ¶ç§»é™¤æ¨¡ç³Šæ•ˆæœ
        updateVisualFilters();

        const area = document.getElementById('choices-area');
        area.classList.remove('show');

        if (GameState.clues.includes('item_charm') && GameState.phase === 'NIGHT') {
            log("æ­»äº¡é™è‡¨ç¬é–“ï¼Œå£è¢‹è£¡çš„å¹³å®‰ç¬¦åŒ–ç‚ºç°ç‡¼ã€‚ä½ æ’¿å›äº†ä¸€æ¢å‘½ã€‚", "success", () => {
                SoundSystem.play('success');
                const index = GameState.clues.indexOf('item_charm');
                GameState.clues.splice(index, 1);
                GameState.sanity = 40;
                GameState.stamina = 40;
                GameState.isGameOver = false;
                updateUI();
                area.innerHTML = "<div style='padding:10px; text-align:center; color:gold'>â˜… å¹³å®‰ç¬¦ç”Ÿæ•ˆ â˜…</div>";
                area.classList.add('show');
                setTimeout(() => {
                    GameState.timeIndex++;
                    nextTimeBlock();
                }, 2000);
            });
            return;
        }

        setTimeout(() => {
            area.innerHTML = `
                <div class="game-over-screen">
                    <div class="game-over-title">${title}</div>
                    <p>${reason}</p>
                    <button onclick="location.reload()" style="margin-top:20px; border-color: red;">é‡æ–°è¼ªè¿´</button>
                </div>
            `;
            area.classList.add('show');
        }, 1000);
    }

    function gameWin() {
        GameState.isGameOver = true;
        SoundSystem.play('success');
        log(`<br><h1 style="color:#4caf50">çµå±€ï¼šå€–å­˜è€…</h1><p>ç¬¬ä¸ƒå¤©çš„é™½å…‰çµ‚æ–¼ç©¿é€äº†æ¿ƒéœ§ã€‚ä½ æ´»ä¸‹ä¾†äº†ã€‚<br>ä½†æ¯ç•¶å¤œæ·±äººéœï¼Œä½ ç¸½è¦ºå¾—æœ‰äººåœ¨èƒŒå¾Œçœ‹è‘—ä½ ã€‚</p>`, 'success', () => {
             document.getElementById('choices-area').innerHTML = `<button onclick="location.reload()">å†æ¬¡æŒ‘æˆ°</button>`;
             document.getElementById('choices-area').classList.add('show');
        });
    }

    // --- æ¨¡æ…‹çª—æ§åˆ¶ ---
    window.openModal = function(id) {
        SoundSystem.play('hover');
        document.getElementById(id).style.display = 'flex';
        if (id === 'rules-modal') renderRules();
        if (id === 'clues-modal') renderClues();
    }
    window.closeModal = function(id) {
        SoundSystem.play('click');
        document.getElementById(id).style.display = 'none';
    }

    function renderRules() {
        const list = document.getElementById('rules-list');
        list.innerHTML = "";
        
        RulesDB.forEach((rule, index) => {
            const li = document.createElement('li');
            let content = `<b>${rule.id}.</b> `;
            
            // å–å¾—ç•¶å‰ç†æ™º
            const s = GameState.sanity;
            
            // --- æ¼¸é€²å¼å´©å£é‚è¼¯ ---
            
            // 1. ç˜‹ç‹‚æ©Ÿç‡ (Insane Text): 
            // åªæœ‰ç•¶ç†æ™ºä½æ–¼ 40 æ™‚æ‰é–‹å§‹æœ‰å¯èƒ½å‡ºç¾ã€‚
            // éš¨è‘—ç†æ™ºå¾ 40 é™åˆ° 0ï¼Œæ©Ÿç‡å¾ 0% æå‡åˆ° 80%
            let insaneChance = 0;
            if (s < 40) {
                insaneChance = (40 - s) / 50; 
            }
            
            // 2. æ‰­æ›²æ©Ÿç‡ (Distorted Text): 
            // ç†æ™ºä½æ–¼ 80 é–‹å§‹å‡ºç¾ã€‚
            // éš¨è‘—ç†æ™ºå¾ 80 é™åˆ° 0ï¼Œæ©Ÿç‡å¾ 0% æå‡åˆ° 100%
            let distortedChance = 0;
            if (s < 80) {
                distortedChance = (80 - s) / 80; 
            }

            // 3. æ¬Šé‡ä¿®æ­£ï¼šè¶Šå¾Œé¢çš„è¦å‰‡ (index è¶Šå¤§) è¶Šå®¹æ˜“å£æ‰
            // é€™æœƒé€ æˆä¸€ç¨®ã€Œå‰é¢å¹¾æ¢é‚„å¾ˆæ­£å¸¸ï¼Œè®€åˆ°å¾Œé¢å»è¶Šä¾†è¶Šä¸å°å‹ã€çš„ææ€–æ„Ÿ
            if (s < 80) {
    distortedChance += (index * 0.03);
}

            // --- åˆ¤å®šé¡¯ç¤ºå…§å®¹ ---
            // å…ˆåˆ¤å®šæ˜¯å¦ç˜‹ç‹‚ (æœ€åš´é‡)ï¼Œå†åˆ¤å®šæ˜¯å¦æ‰­æ›²ï¼Œæœ€å¾Œæ‰æ˜¯æ­£å¸¸
            
            if (Math.random() < insaneChance) {
                // åš´é‡ç²¾ç¥æ±¡æŸ“ç‹€æ…‹ï¼šé¡¯ç¤ºç´…è‰²ç˜‹ç‹‚æ–‡å­—
                content += `<span class="rule-corrupted" style="font-family:Impact;">${rule.insane}</span>`;
                
                // è¦–è¦ºç‰¹æ•ˆï¼šè®“é€™è¡Œå­—å¾®å¾®æ­ªæ–œ
                li.style.transform = `skewX(${Math.random() * 10 - 5}deg)`;
                li.style.borderLeftColor = "#d32f2f"; // å·¦é‚Šæ¡†è®Šç´…
                li.style.background = "rgba(211, 47, 47, 0.1)";
            } 
            else if (Math.random() < distortedChance) {
                // è¼•å¾®èªçŸ¥æ‰­æ›²ï¼šé¡¯ç¤ºç°è‰²èª˜å°æ–‡å­—
                content += `<span style="color:#bdc3c7; letter-spacing: 1px;">${rule.distorted}</span>`;
                li.style.borderLeftColor = "#777"; 
            } 
            else {
                // æ­£å¸¸ç‹€æ…‹
                content += rule.original;
            }

            li.innerHTML = content;
            list.appendChild(li);
        });
    }

    function renderClues() {
        const list = document.getElementById('clues-list');
        list.innerHTML = "";
        if (GameState.clues.length === 0) {
            list.innerHTML = '<li style="color: #666;">ç›®å‰æ²’æœ‰ä»»ä½•ç·šç´¢ã€‚</li>';
            return;
        }
        GameState.clues.forEach(clueId => {
            const li = document.createElement('li');
            li.innerText = CluesDB[clueId] || "æœªçŸ¥çš„ç¢ç‰‡";
            li.style.color = clueId.startsWith('item') ? "#ffd700" : "#aed581";
            list.appendChild(li);
        });
    }

    // --- éŠæˆ²æµç¨‹ ---
    function startGame() {
        const area = document.getElementById('choices-area');
        area.classList.remove('show');
        area.innerHTML = "";
        log("<br>--- ç¬¬ 1 å¤œ é–‹å§‹ ---", "system", () => nextTimeBlock());
    }

    function nextTimeBlock() {
        if (GameState.isGameOver) return;

        if (GameState.timeIndex >= GameState.timePoints.length) {
            endNight();
            return;
        }

        // --- æ–°å¢ï¼šçµç®—ä¸Šä¸€æ™‚æ®µæœªè™•ç†çš„å¨è„… ---
        CCTVSystem.checkUnpurgedThreats();

        // â˜…â˜…â˜… ä¿®æ­£é»ï¼šå¦‚æœçµç®—å¨è„…å¾Œå°è‡´æ­»äº¡ï¼Œç«‹å³åœæ­¢å¾ŒçºŒé‚è¼¯ â˜…â˜…â˜…
        if (GameState.isGameOver) return; 

        // --- æ–°å¢ï¼šéš¨æ©Ÿç”¢ç”Ÿä¸‹ä¸€æ™‚æ®µçš„æ–°å¨è„… ---
        CCTVSystem.generatePassiveThreats();

        updateUI();
        let currentTime = GameState.timePoints[GameState.timeIndex];
        
        // ä¸‹æ–¹é‚è¼¯ä¿æŒä¸è®Š...
        document.getElementById('choices-area').classList.remove('show');

        log(`<br>=== æ™‚é–“ï¼š${currentTime} ===`, 'system', () => {
            if (currentTime === "03:00") renderThreeAMChoice();
            else generateEvent();
        });
    }

    function renderThreeAMChoice() {
        log("ç¾åœ¨æ˜¯å‡Œæ™¨3é»ã€‚å…¬å¯“é™°æ°£æœ€é‡ï¼Œä½†ä¹Ÿæ˜¯æš«æ™‚èº²é¿çš„æ©Ÿæœƒã€‚", "system", () => {
            const area = document.getElementById('choices-area');
            area.innerHTML = "";

            createButton("å›åˆ°ä¿å®‰å®¤ä¼‘æ¯", () => {
                if (GameState.stamina < 15) {
                    area.classList.remove('show');
                    log("ä½ å¤ªç´¯äº†ï¼Œèµ°ä¸å›å»äº†...", "danger", () => generateEvent());
                    return;
                }
                area.classList.remove('show');
                log("ä½ é–ä¸Šé–€é–‰ç›®é¤Šç¥ã€‚å¤–é¢çš„è²éŸ³è¢«éš”çµ•äº†ã€‚", "success", () => {
                    changeStat('stamina', -15);
                    changeStat('sanity', 15);
                    changeStat('corruption', -10);
                    setTimeout(() => {
                        GameState.timeIndex++;
                        nextTimeBlock();
                    }, 500);
                });
            }, false, true);

            createButton("ç¹¼çºŒå·¡é‚", () => {
                area.classList.remove('show');
                log("ä½ æ‹¿èµ·æ‰‹é›»ç­’ï¼Œç¹¼çºŒé¢å°é»‘æš—ã€‚", "event", () => generateEvent());
            });

            area.classList.add('show');
        });
    }

    function endNight() {
        document.getElementById('choices-area').classList.remove('show');
        log("<br>--- 6:00 AM ---<br>é›é³´è²éŸ¿èµ·ï¼Œä½ æ´»éäº†é€™ä¸€å¤œã€‚", "success", () => {
            GameState.usedEvents = []; 
            if (GameState.day >= 7) gameWin();
            else {
                GameState.phase = "DAY";
                GameState.timeIndex = 0;
                updateUI();
                showDayPhase();
            }
        });
    }

    function showDayPhase() {
        log(`<br>ã€ç¬¬ ${GameState.day} å¤© - ç™½å¤©ã€‘<br>åˆ©ç”¨ç™½å¤©æ¢å¾©ç‹€æ…‹ã€‚`, "event", () => {
            const area = document.getElementById('choices-area');
            area.innerHTML = "";
            createButton("æ·±å±¤ç¡çœ ", () => handleDayAction('sleep'));
            createButton("èª¿æŸ¥å…¬å¯“æ­·å²", () => handleDayAction('investigate'));
            if (GameState.corruption > 30) createButton("å»å¯ºå»Ÿæ‹œæ‹œ", () => handleDayAction('temple'));
            area.classList.add('show');
        });
    }

    function handleDayAction(action) {
        const area = document.getElementById('choices-area');
        area.classList.remove('show');
        setTimeout(() => {
            if (action === 'sleep') {
                log("ä½ åƒäº†å®‰çœ è—¥ï¼Œç¡äº†å€‹å¥½è¦ºã€‚", "success", proceedToNextNight);
                changeStat('sanity', 30);
                changeStat('stamina', 40);
            } else if (action === 'investigate') {
                log("ä½ èª¿æŸ¥äº†èˆŠå ±ç´™...ç™¼ç¾äº†ä¸€äº›å¯æ€•çš„äº‹å¯¦ã€‚", "event", () => {
                    changeStat('sanity', 10);
                    changeStat('stamina', -10);
                    changeStat('corruption', 5);
                    findClue();
                    proceedToNextNight();
                });
            } else if (action === 'temple') {
                log("è€å’Œå°šçµ¦äº†ä½ ç¬¦æ°´ã€‚ä½ æ„Ÿè¦ºè¼•é¬†äº†ä¸€äº›ã€‚", "success", proceedToNextNight);
                changeStat('corruption', -20);
                changeStat('stamina', -20);
            }
        }, 500);
    }
    
    function proceedToNextNight() {
        setTimeout(() => {
            GameState.day++;
            GameState.phase = "NIGHT";
            log(`<br>--- ç¬¬ ${GameState.day} å¤œ é–‹å§‹ ---`, "system", () => nextTimeBlock());
        }, 1000);
    }

    function findClue() {
        let possibleClues = [];
        if (GameState.day === 1) possibleClues = ['clue_404', 'item_flashlight'];
        else if (GameState.day === 2) possibleClues = ['clue_red_lady', 'clue_tie'];
        else if (GameState.day === 3) possibleClues = ['clue_vending', 'clue_package'];
        else if (GameState.day === 4) possibleClues = ['clue_mirror', 'item_charm'];
        else if (GameState.day >= 5) possibleClues = ['clue_manager', 'clue_moon'];

        possibleClues = possibleClues.filter(c => !GameState.clues.includes(c));
        if (possibleClues.length > 0) {
            const newClue = possibleClues[Math.floor(Math.random() * possibleClues.length)];
            GameState.clues.push(newClue);
            SoundSystem.play('success');
            log(`ã€ç²å¾—ã€‘ï¼š${CluesDB[newClue]}`, "success");
        } else log("ä½ ä¸€ç„¡æ‰€ç²ã€‚", "system");
    }

    function generateEvent() {
        let event = null;
        const day = GameState.day;
        const time = GameState.timePoints[GameState.timeIndex];

        // 1. å„ªå…ˆè™•ç†å›ºå®šåŠ‡æƒ…äº‹ä»¶
        if (day === 7 && time === "05:00") event = EventLibrary["final_confrontation"];
        else if (day === 3 && time === "01:00") event = EventLibrary["red_lady_encounter"];
        else if (day === 5 && time === "03:00") event = EventLibrary["mirror_reflection"];
        else if (day === 6 && time === "23:00") event = EventLibrary["blood_moon"];
        else {
            // 2. æ±™æŸ“äº‹ä»¶æª¢å®šæ©Ÿåˆ¶
            let isCorruptionEvent = false;
            
            if (GameState.corruption > 15) {
                const corruptionChance = GameState.corruption / 120; 
                if (Math.random() < corruptionChance) {
                    isCorruptionEvent = true;
                }
            }

            if (isCorruptionEvent) {
                const corrKeys = Object.keys(CorruptionEventLibrary);
                // é˜²å‘†ï¼šç¢ºä¿æ±™æŸ“äº‹ä»¶åº«æœ‰æ±è¥¿
                if (corrKeys.length > 0) {
                    const randKey = corrKeys[Math.floor(Math.random() * corrKeys.length)];
                    event = CorruptionEventLibrary[randKey];
                }
                SoundSystem.play('glitch');
            } 
            
            // å¦‚æœä¸æ˜¯æ±™æŸ“äº‹ä»¶ï¼Œæˆ–æ±™æŸ“äº‹ä»¶æŠ“å–å¤±æ•—ï¼Œå‰‡åŸ·è¡Œæ¨™æº–äº‹ä»¶
            if (!event) {
                // 3. æ¨™æº–éš¨æ©Ÿäº‹ä»¶
                const fullPool = [
                    "noise_upstairs", "elevator_b1", "phone_call", "vending_machine", 
                    "hallway_shadow", "strange_smell", "crying_baby", 
                    "midnight_delivery", "cctv_anomaly", "manager_visit", "lost_girl", "power_outage",
                    "room_404_encounter", "phantom_pet", "glitch_anomaly",
                    "neighbor_knock", "restock_man", "extra_floor", "red_tie_gift",
                    "fake_rule_note", "toy_dog", "green_drink", "neighbor_405",
                    "vending_purple", "manager_scarf", "elevator_mirror", "stray_dog_shadow",
                    "vending_leaking", "manager_choice", "cleaner_green", "room_403_party",
                    "courier_404", "laundry_red", "elevator_maintain", "manager_id",
                    "trick_fire_check", "trick_blind_dog", "trick_elevator_voice",  
                    "trick_grandma_404", "trick_manager_reflection", "trick_trash_rules"
                ];
                
                let availablePool = fullPool.filter(id => !GameState.usedEvents.includes(id));
                if (availablePool.length === 0) { availablePool = fullPool; GameState.usedEvents = []; }
                
                // --- ä¿®æ­£é‡é»ï¼šå®‰å…¨æŠ½å–è¿´åœˆ ---
                let validEventFound = false;
                let attempts = 0;
                
                while (!validEventFound && attempts < 10) {
                    const randId = availablePool[Math.floor(Math.random() * availablePool.length)];
                    
                    if (EventLibrary[randId]) {
                        event = EventLibrary[randId];
                        GameState.usedEvents.push(randId);
                        validEventFound = true;
                    } else {
                        console.error("ç™¼ç¾ç„¡æ•ˆçš„äº‹ä»¶ ID:", randId); // åœ¨æ§åˆ¶å°å ±éŒ¯ï¼Œä½†ä¸å¡æ­»éŠæˆ²
                        // å¾æš«æ™‚æ± ä¸­ç§»é™¤é€™å€‹å£æ‰çš„ IDï¼Œé¿å…ä¸‹æ¬¡é¦¬ä¸ŠåˆæŠ½åˆ°
                        availablePool = availablePool.filter(id => id !== randId);
                        if(availablePool.length === 0) availablePool = fullPool; 
                    }
                    attempts++;
                }
            }
        }

        // --- æœ€çµ‚é˜²å‘†ï¼šå¦‚æœ event é‚„æ˜¯ null (æ¥µç«¯ç‹€æ³)ï¼Œçµ¦ä¸€å€‹é è¨­äº‹ä»¶ ---
        if (!event) {
            console.warn("ç”Ÿæˆäº‹ä»¶å¤±æ•—ï¼Œä½¿ç”¨å‚™ç”¨äº‹ä»¶ã€‚");
            event = {
                text: "èµ°å»Šä¸Šä¸€ç‰‡æ­»å¯‚ï¼Œåªæœ‰é›»æµçš„å—¡å—¡è²...ä»€éº¼äº‹éƒ½æ²’ç™¼ç”Ÿã€‚",
                choices: [
                    { text: "ç¹¼çºŒå·¡é‚", action: () => { log("ä½ ç¹¼çºŒå‰å¾€ä¸‹ä¸€å€‹å·¡é‚é»ã€‚", "event"); } }
                ]
            };
        }

        renderEvent(event);
    }

    function renderEvent(eventData) {
        const isCorrupted = Object.values(CorruptionEventLibrary).some(e => e.text === eventData.text);
        
        let prefix = "";
        if (isCorrupted) {
            prefix = "<span style='color:#ef5350; font-family:Impact; letter-spacing:1px;'>[ è­¦å‘Šï¼šæ€ç¶­é­åˆ°å…¥ä¾µ ]</span><br>";
        }

        // ç¢ºä¿ eventData.text å­˜åœ¨ï¼Œé˜²æ­¢å ±éŒ¯
        const eventText = eventData.text || "ï¼ˆç„¡æ³•è§£æçš„äº‹ä»¶ä¿¡è™Ÿ...ï¼‰";

        log(prefix + eventText, isCorrupted ? 'insane' : 'event', () => {
            const area = document.getElementById('choices-area');
            area.innerHTML = "";

            let choices = [...eventData.choices];
            if (GameState.sanity < 70) {
                choices.sort(() => Math.random() - 0.5);
            }

            choices.forEach(choice => {
                // å®‰å…¨æª¢æŸ¥ï¼šç¢ºä¿ choice å°è±¡å®Œæ•´
                if (!choice) return;
                
                if (choice.reqClue && !GameState.clues.includes(choice.reqClue)) return;
                
                // å¢åŠ  try-catch åŒ…è£¹æ¢ä»¶åˆ¤æ–·ï¼Œé˜²æ­¢ condition å‡½æ•¸å ±éŒ¯
                try {
                    if (choice.condition && !choice.condition()) return;
                } catch(e) { console.warn("Condition check failed", e); return; }

                if (choice.sanityGate && GameState.sanity < choice.sanityGate) return;

                let isInsane = false;
                let btnText = choice.text || "???";

                if (isCorrupted || (GameState.sanity < 20 && Math.random() < 0.3)) {
                    isInsane = true;
                    if (!isCorrupted && GameState.sanity < 20) btnText = "æ­»æ­»æ­»æ­»æ­»æ­»æ­»æ­»";
                }

                createButton(btnText, () => {
                    // ä½¿ç”¨ flag é˜²æ­¢é‡è¤‡æ¨é€²
                    let hasAdvanced = false;

                    try {
                        // 1. å…ˆå˜—è©¦è¨˜éŒ„æ—¥èªŒ (ç§»å…¥ try å€å¡Š)
                        const safeText = choice.text ? choice.text.replace(/<[^>]*>?/gm, '') : "è¡Œå‹•";
                        log(`> é¸æ“‡ï¼š${safeText}`, "system");
                        
                        // 2. åŸ·è¡Œé¸é …é‚è¼¯
                        if (choice.action) {
                            choice.action();
                        }
                    } catch(err) {
                        console.error("Event Action Error:", err);
                        // ç™¼ç”ŸéŒ¯èª¤æ™‚çµ¦äºˆæç¤ºï¼Œä½†ä¸ä¸­æ–·éŠæˆ²
                        log("ä½ è©¦åœ–åšå‡ºè¡Œå‹•ï¼Œä½†æ„è­˜æ¨¡ç³Šäº†ä¸€ç¬é–“...", "system");
                    } finally {
                        // 3. ç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œåªè¦éŠæˆ²æ²’çµæŸï¼Œéƒ½å˜—è©¦æ¨é€²æ™‚é–“
                        if (!GameState.isGameOver && !hasAdvanced) {
                            hasAdvanced = true;
                            setTimeout(() => {
                                // å†æ¬¡æª¢æŸ¥éŠæˆ²æ˜¯å¦åœ¨ç­‰å¾…æœŸé–“çµæŸ
                                if (!GameState.isGameOver) {
                                    GameState.timeIndex++;
                                    nextTimeBlock();
                                }
                            }, 1500 + (Math.random() * 1000));
                        }
                    }
                }, isInsane);
            });
            
            area.classList.add('show');

            // åªæœ‰åœ¨éŠæˆ²æœªçµæŸä¸”æŒ‰éˆ•ç”Ÿæˆå¾Œæ‰å•Ÿå‹•è¨ˆæ™‚
            if (!GameState.isGameOver) {
                PanicSystem.start(10, () => { 
                    const allBtns = document.querySelectorAll('#choices-area button');
                    allBtns.forEach(b => b.disabled = true);
                    area.classList.remove('show');
                    
                    SoundSystem.play('damage');
                    log("ä½ å› ç‚ºæ¥µåº¦ææ‡¼è€Œå…¨èº«åƒµç¡¬ï¼Œç„¡æ³•åšå‡ºåæ‡‰ï¼è©­ç•°çš„å­˜åœ¨è¶æ©Ÿä¾µè•äº†ä½ ...", "danger");
                    changeStat('stamina', -25);
                    changeStat('sanity', -15);
                    
                    if (!GameState.isGameOver) {
                        setTimeout(() => {
                            GameState.timeIndex++;
                            nextTimeBlock();
                        }, 2000);
                    }
                });
            }
        });
    }

    // --- æ–°å¢ï¼šæ·±åº¦æ±™æŸ“å°ˆå±¬äº‹ä»¶åº« ---
    const CorruptionEventLibrary = {
        "corr_skin_peel": {
            text: "ä½ çš„æ‰‹è‡‚å¥‡ç™¢ç„¡æ¯”ã€‚ä½ å¿ä¸ä½æŠ“æ’“ï¼Œä¸€å¤§å¡Šçš®è†šåƒæ¿•ç´™ä¸€æ¨£è¢«æ’•äº†ä¸‹ä¾†ï¼Œéœ²å‡ºäº†åº•ä¸‹**é»‘è‰²ã€å …ç¡¬çš„é±—ç‰‡**ã€‚<br>å¥‡æ€ªçš„æ˜¯ï¼Œä½ ä¸€é»éƒ½ä¸è¦ºå¾—ç—›ï¼Œåè€Œè¦ºå¾—...å¾ˆç¾ã€‚",
            choices: [
                { text: "æ’•ä¸‹æ›´å¤šçš®è†š", action: () => {
                    log("ä½ è‘—é­”ä¼¼åœ°æ’•æ‰¯è‘—å¤šé¤˜çš„ã€äººçš®ã€ï¼Œéœ²å‡ºäº†æ›´å¤šç¾éº—çš„æ–°ç”Ÿè‚Œè†šã€‚ä½ æ„Ÿè¦ºå……æ»¿åŠ›é‡ã€‚", "danger");
                    changeStat('corruption', 15);
                    changeStat('sanity', -10);
                    changeStat('stamina', 10); // è®Šç•°å¸¶ä¾†é«”åŠ›
                }},
                { text: "ç”¨ç¹ƒå¸¶çºä½", action: () => {
                    log("ä½ é¡«æŠ–è‘—æŠŠå‚·å£åŒ…èµ·ä¾†ï¼Œå‡è£æ²’çœ‹è¦‹é‚£äº›é±—ç‰‡ã€‚ä½†ä½ æ„Ÿè¦ºå®ƒå€‘æ­£åœ¨ä½ çš„è‚‰è£¡å‘¼å¸ã€‚", "event");
                    changeStat('sanity', -20);
                }},
                { text: "ç”¨åˆ€åˆ®æ‰é±—ç‰‡", action: () => {
                    log("ä½ è©¦åœ–å‰²æ‰é±—ç‰‡ï¼ŒåŠ‡ç—›è®“ä½ å·®é»æ˜éå»ï¼Œé®®è¡€å™´æ»¿äº†åœ°æ¿ã€‚", "danger");
                    changeStat('stamina', -30);
                    changeStat('sanity', -10);
                }}
            ]
        },
        "corr_delicious_stain": {
            text: "ä½ æ„Ÿåˆ°æ¥µåº¦çš„é£¢é¤“ã€‚ä½ çœ‹å‘ç‰†è§’ä¸€ç˜ä¸çŸ¥ä½•æ™‚ç•™ä¸‹çš„**æš—ç´…è‰²è¡€æ¼¬**ï¼Œèèµ·ä¾†ç«Ÿæ¯”ä¸–ç•Œä¸Šä»»ä½•ç¾é£Ÿéƒ½è¦é¦™ç”œã€‚<br>å£æ°´ä¸å—æ§åˆ¶åœ°æµäº†ä¸‹ä¾†ã€‚",
            choices: [
                { text: "èˆ”ä¸€å£", action: () => {
                    log("ç”œç¾ï¼å……æ»¿éµé½å‘³çš„ç”˜éœ²é †è‘—å–‰åš¨æ»‘ä¸‹ï¼Œä½ çš„èƒƒç™¼å‡ºäº†æ»¿è¶³çš„è •å‹•è²ã€‚", "danger");
                    changeStat('corruption', 20);
                    changeStat('stamina', 15);
                }},
                { text: "åƒå£“ç¸®é¤…ä¹¾", action: () => {
                    log("ä½ å¼·è¿«è‡ªå·±åƒä¸‹äººé¡çš„é£Ÿç‰©ï¼Œä½†å®ƒå€‘åœ¨ä½ å˜´è£¡å°±åƒä¹¾ç‡¥çš„ç°ç‡¼ï¼Œä»¤äººä½œå˜”ã€‚", "event");
                    changeStat('stamina', -5); // åƒä¸ä¸‹å»
                    changeStat('sanity', -10);
                }},
                { text: "å‚¬å", action: () => {
                    log("ä½ è©¦åœ–æŠŠé‚£ç¨®æ¸´æœ›æ„Ÿåå‡ºä¾†ï¼Œä½†åªåå‡ºäº†ä¸€äº›é»‘è‰²çš„é…¸æ°´ã€‚", "danger");
                    changeStat('stamina', -15);
                }}
            ]
        },
        "corr_friendly_shadow": {
            text: "èµ°å»Šç›¡é ­ç«™è‘—é‚£å€‹é»‘å½±æ€ªç‰©ã€‚ä½†é€™ä¸€æ¬¡ï¼Œä½ çœ‹å¾—æ¸…æ¸…æ¥šæ¥šâ€”â€”é‚£ä¸æ˜¯æ€ªç‰©ï¼Œé‚£æ˜¯**ä½ çš„å®¶äºº**ã€‚<br>å®ƒå¼µé–‹æ‰­æ›²çš„æ‰‹è‡‚ï¼Œæº«æŸ”åœ°å‘¼å–šä½ çš„åå­—ã€‚",
            choices: [
                { text: "èµ°éå»æ“æŠ±", action: () => {
                    log("ä½ æŠ•å…¥å®ƒçš„æ‡·æŠ±ï¼Œæ„Ÿè¦ºå†°å†·é»è†©ã€‚å®ƒåœ¨ä½ è€³é‚Šä½èªï¼šã€å†ä¸€é»é»ï¼Œä½ å°±å®Œå…¨å±¬æ–¼æˆ‘å€‘äº†ã€‚ã€", "danger");
                    changeStat('corruption', 25);
                    changeStat('sanity', -15);
                }},
                { text: "å¤§è²æ–¥è²¬", action: () => {
                    log("ä½ æ€’å¼è‘—é©…è¶•å®ƒã€‚å®ƒéœ²å‡ºäº†å—å‚·çš„è¡¨æƒ…ï¼ˆå„˜ç®¡å®ƒæ²’æœ‰è‡‰ï¼‰ï¼Œç·©ç·©é€€å›é»‘æš—ã€‚", "event");
                    changeStat('sanity', -20);
                }},
                { text: "é–‹æ§/æ”»æ“Š", action: () => {
                    log("ä½ ç˜‹ç‹‚æ”»æ“Šï¼Œä½†æ‰“ä¸­çš„åªæœ‰ç©ºæ°£ã€‚ä½ æ„è­˜åˆ°è‡ªå·±æ­£åœ¨æ”»æ“Šç‰†å£ã€‚", "danger");
                    changeStat('stamina', -15);
                    changeStat('sanity', -10);
                }}
            ]
        },
        "corr_rule_change": {
            text: "ä½ å†æ¬¡é–±è®€ä¿å®‰å®ˆå‰‡ã€‚ä¸Šé¢çš„æ–‡å­—æ­£åœ¨åƒèŸ²å­ä¸€æ¨£è •å‹•é‡çµ„ï¼š<br>ã€**è¦å‰‡0ï¼šå…¬å¯“æ˜¯å®‰å…¨çš„ã€‚ä½æˆ¶æ˜¯å®¶äººã€‚ä¸è¦æŠµæŠ—è®ŠåŒ–ã€‚æ¥å—å®ƒã€‚**ã€<br>é€™çœ‹èµ·ä¾†æ‰æ˜¯å”¯ä¸€çš„çœŸç†ã€‚",
            choices: [
                { text: "å¤§è²æœ—è®€", action: () => {
                    log("ä½ çš„è²éŸ³è®Šå¾—å˜¶å•ä½æ²‰ï¼Œä¸åƒæ˜¯äººé¡çš„ç™¼è²æ§‹é€ èƒ½ç™¼å‡ºçš„è²éŸ³ã€‚è¦å‰‡éŠ˜åˆ»é€²äº†ä½ çš„è…¦æµ·ã€‚", "danger");
                    changeStat('corruption', 20);
                    changeStat('sanity', 10); // æ¥å—ç˜‹ç‹‚åè€Œå›å¾©ç†æ™º
                }},
                { text: "ç‡’æ¯€å®ˆå‰‡", action: () => {
                    log("ä½ é»ç‡ƒäº†ç´™å¼µï¼Œä½†ç«ç„°æ˜¯ç¶ è‰²çš„ã€‚ç´™ç‡’å…‰äº†ï¼Œé‚£è¡Œå­—å»çƒ™å°åœ¨ä½ çš„è¦–ç¶²è†œä¸Šã€‚", "danger");
                    changeStat('sanity', -25);
                }},
                { text: "é–‰çœ¼ä¸çœ‹", action: () => {
                    log("ä½ åœ¨å¿ƒä¸­é»˜å¿µèˆŠçš„è¦å‰‡ï¼Œè©¦åœ–å°æŠ—è…¦ä¸­çš„è²éŸ³ã€‚", "event");
                    changeStat('sanity', -10);
                }}
            ]
        },
        "corr_mirror_beauty": {
            text: "ä½ ç…§é¡å­ã€‚é¡ä¸­çš„äººè‡‰è‰²æ…˜ç™½ï¼Œçœ¼çƒå…¨é»‘ï¼Œå˜´è§’è£‚é–‹åˆ°è€³æ ¹ï¼Œçš®è†šæ­£åœ¨æ½°çˆ›ã€‚<br>**å¤©å•Šï¼Œé€™çœŸæ˜¯å¤ªå®Œç¾äº†ã€‚** é€™æ‰æ˜¯é€²åŒ–çš„çµ‚æ¥µå½¢æ…‹ã€‚",
            choices: [
                { text: "æ¬£è³è‡ªå·±", action: () => {
                    log("ä½ å°è‘—é¡å­ç·´ç¿’å¾®ç¬‘ï¼Œè£‚å£è™•æ»²å‡ºäº†é»‘è¡€ã€‚ä½ çœ‹å¾—å¦‚ç™¡å¦‚é†‰ã€‚", "danger");
                    changeStat('corruption', 15);
                    changeStat('sanity', 5); // å¯©ç¾æ”¹è®Š
                }},
                { text: "ç ¸ç¢é¡å­", action: () => {
                    log("ã€ä¸å‡†ä½ æ¯€äº†é€™éº¼ç¾çš„è—è¡“å“ï¼ã€ä½ å…§å¿ƒæœ‰å€‹è²éŸ³åœ¨å°–å«ï¼Œä½ çš„æ‰‹ä¸è½ä½¿å–šåœ°åœä¸‹äº†ã€‚", "danger");
                    changeStat('sanity', -20);
                    changeStat('corruption', 5);
                }},
                { text: "åŒ–å¦/æ•´ç†", action: () => {
                    log("ä½ è©¦åœ–æŠŠæ’•è£‚çš„å˜´è§’è®Šå¾—æ›´å¤§ä¸€é»ï¼Œä»¥ä¾¿ç¬¦åˆé€™å®Œç¾çš„é€ å‹ã€‚", "danger");
                    changeStat('stamina', -20);
                    changeStat('corruption', 10);
                }}
            ]
        }
    };

    const EventLibrary = {
        "trick_fire_check": {
            text: "é–€å¤–å‚³ä¾†æ€¥ä¿ƒæ‹é–€è²ï¼Œå…©å€‹æ¶ˆé˜²å“¡ç¥è‰²æ…Œå¼µï¼šã€å¤§æ¨“åµæ¸¬åˆ°ç“¦æ–¯å¤–æ´©ï¼ç«å‹¢æ­£åœ¨è”“å»¶ï¼å¿«é–‹é–€è®“æˆ‘å€‘é€²å»ï¼ã€",
            choices: [
                { text: "é…åˆç·Šæ€¥ç‹€æ³é–‹é–€", action: () => {
                    log("é«˜æº«æ°£æµªå°‡ä½ è½Ÿé£›ã€‚ä½ æ‰‹è‡‚åš´é‡ç‡’å‚·ã€‚", "danger");
                    changeStat('stamina', -40);
                    changeStat('sanity', -20);
                }},
                { text: "å¤§å–Šï¼šã€ç¦æ­¢é–‹é–€ï¼ã€", action: () => {
                    log("æ¶ˆé˜²å“¡è¡¨æƒ…ç¬é–“åƒµç¡¬ï¼šã€çœŸå¯æƒœ...ã€éš¨å¾ŒåŒ–ä½œç°ç‡¼æ¶ˆå¤±ã€‚", "success");
                    changeStat('sanity', -5);
                }},
                { text: "è½‰èº«æª¢æŸ¥ç›£æ§", action: () => {
                    log("ç›£æ§é¡¯ç¤ºé–€å£æ ¹æœ¬æ²’äººã€‚ç»ç’ƒä¸Šå»ç•™ä¸‹ä¸€å°ç„¦é»‘çš„æ‰‹å°ã€‚", "danger");
                    changeStat('sanity', -15);
                    changeStat('stamina', -5);
                }}
            ]
        },
        "trick_blind_dog": {
            text: "ç›²äººè€å…ˆç”Ÿæ•²çª—ï¼šã€å¹´è¼•äººï¼Œæˆ‘çš„å°ç›²çŠ¬å¥½åƒä¸èˆ’æœï¼Œèƒ½å€Ÿé»æ°´å—ï¼Ÿã€",
            choices: [
                { text: "çµ¦æ°´", action: () => {
                    log("é‚£æ±è¥¿æŠ“ä½ä½ çš„æ‰‹ï¼Œå°–éŠ³æŒ‡ç”²åˆºå…¥çš®è‚‰ã€‚", "danger");
                    changeStat('stamina', -30);
                    changeStat('corruption', 25);
                }},
                { text: "åš´å²é©…è¶•", action: () => {
                    log("è€å…ˆç”Ÿéœ²å‡ºè©­ç•°ç¬‘å®¹ï¼šã€è¢«ç™¼ç¾äº†å—...ã€èµ°é€²ç‰†å£æ¶ˆå¤±äº†ã€‚", "success");
                    changeStat('sanity', -5);
                }},
                { text: "ä¿æŒæ²‰é»˜ä¸å‹•", action: () => {
                    log("ç‹—çªç„¶ç™¼å‡ºåƒäººé¡å“­è²çš„å“€åšã€‚", "danger");
                    changeStat('sanity', -10);
                }}
            ]
        },
        "trick_elevator_voice": {
            text: "é›»æ¢¯ä¸‹è¡Œè‡³ B1ã€‚ä½ é–‰çœ¼é»˜æ•¸ã€‚å»£æ’­å‚³ä¾†æ¸…æ™°å¥³è²ï¼šã€B1 åˆ°äº†ï¼Œé–‹é–€ã€‚ã€ä¼´éš¨é€¼çœŸé–‹é–€è²ã€‚",
            choices: [
                { text: "çœé–‹çœ¼ç›é›¢é–‹", action: () => {
                    log("é–€æ²’é–‹ï¼Œä½†æœ‰æ±è¥¿ç©¿é€é–€æ¿è¡æ“Šäº†ä½ çš„å¤§è…¦ã€‚", "danger");
                    changeStat('sanity', -45);
                }},
                { text: "ç¹¼çºŒé–‰çœ¼é»˜æ•¸", action: () => {
                    log("ä½ å …æŒæ•¸å®Œ10ç§’ã€‚å†æ¬¡ç¢ºèªå¾Œï¼Œéœ‡å‹•æ‰çœŸæ­£åœæ­¢ã€‚", "success");
                    changeStat('sanity', -10);
                }}
            ]
        },
        "trick_grandma_404": {
            text: "ä¸€ä½è€å¥¶å¥¶è·Œå€’åœ¨ **404è™Ÿæˆ¿** é–€å£ï¼Œé–€å¾®å¾®æ‰“é–‹ã€‚å¥¹ä¼¸æ‰‹å‘ä½ æ±‚åŠ©ã€‚",
            choices: [
                { text: "éå»æ‰¶å¥¹", action: () => {
                    log("404é–€çŒ›åœ°æ‰“é–‹ï¼Œç„¡æ•¸éš»æ‰‹è©¦åœ–å°‡ä½ æ‹–é€²å»ã€‚", "danger");
                    changeStat('stamina', -35);
                    changeStat('sanity', -15);
                }},
                { text: "ä½é ­å¿«é€Ÿé€šé", action: () => {
                    log("èº«å¾Œå‚³ä¾†è®Šèª¿çš„å°–å«ï¼šã€ç‚ºä»€éº¼ä¸éä¾†ï¼ã€", "success");
                    changeStat('sanity', -15);
                    changeStat('corruption', 5);
                }}
            ]
        },
        "trick_manager_reflection": {
            text: "ç¶“ç†æœ¬äººå¸¶è‘— **è—è‰²è­˜åˆ¥è­‰**ã€‚ä½†é¡å­è£¡çš„ä»–å¸¶è‘— **ç´…è‰²è­˜åˆ¥è­‰**ã€‚",
            choices: [
                { text: "ç›¸ä¿¡æœ¬äºº", action: () => {
                    log("é¡åƒè¡å‡ºä¾†æä½ä½ ã€‚ä½ ç”¨æ‰‹é›»ç­’ç ¸ç¢é¡é¢ï¼Œç¢ç‰‡åŠƒç ´è‡‰ã€‚", "danger");
                    changeStat('stamina', -30);
                    changeStat('sanity', -20);
                }},
                { text: "ç›¸ä¿¡é¡åƒ", action: () => {
                    log("ä½ å‡è£æ²’çœ‹è¦‹ã€‚ç¶“ç†çœ‹å‘é¡å­ï¼Œç™¼å‡ºå˜–çš„ä¸€è²é›¢é–‹äº†ã€‚", "success");
                    changeStat('sanity', -10);
                }},
                { text: "æ‰“ç ´é¡å­", action: () => {
                    log("ä½ ç ¸ç¢é¡å­ã€‚ç¶“ç†æ¶ˆå¤±äº†ï¼Œåªç•™ä¸‹ä¸€åœ°ç¢ç»ç’ƒå’Œç´…è‰²è­˜åˆ¥è­‰ã€‚", "danger");
                    changeStat('stamina', -15);
                    changeStat('sanity', -5);
                }}
            ]
        },
        "trick_trash_rules": {
            text: "åƒåœ¾æ¡¶æ—å…¬å‘Šï¼šã€å°åˆ·éŒ¯èª¤ï¼Œè¦å‰‡7æ›´æ­£ç‚ºâ€”â€”ç´…è‰²é£²æ–™å®‰å…¨ï¼Œè—è‰²æœ‰æ¯’ã€‚ã€",
            choices: [
                { text: "ç›¸ä¿¡å…¬å‘Š", action: () => {
                    log("å–ä¸‹ç´…è‰²é£²æ–™å¾Œï¼Œä½ å˜”åå‡ºå¤§é‡é»‘æ°´ã€‚", "danger");
                    changeStat('stamina', -40);
                    changeStat('corruption', 20);
                }},
                { text: "ç„¡è¦–å…¬å‘Š", action: () => {
                    log("è¦å‰‡æ›¸æ˜¯çµ•å°çš„ï¼Œä¸èƒ½è¼•ä¿¡è·¯é‚Šåƒåœ¾ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "å¸¶å›ä¿å®‰å®¤ç ”ç©¶", action: () => {
                    log("ç´™ä¸Šçš„å­—è®Šæˆï¼šã€ä½ çœŸå¥½é¨™ã€‚ã€ç„¶å¾Œè‡ªç‡ƒã€‚", "event");
                    changeStat('sanity', -5);
                }}
            ]
        },
        "courier_404": {
            text: "å¿«éå“¡åœ¨é–€å£å–Šï¼šã€404æ˜¯å§ï¼Ÿæ€éº¼æ²’äººæ¥ï¼Ÿä¿å®‰ï¼Œå¹«å¿™è¯çµ¡ä¸€ä¸‹ã€‚ã€",
            choices: [
                { text: "å‘Šè¨´ä»–404æ²’äºº", action: () => {
                    log("å¿«éå“¡è‡‰èåŒ–äº†ï¼šã€æ²’äººï¼Ÿé‚£é›»è©±æ˜¯èª°æ¥çš„ï¼Ÿã€", "event");
                    changeStat('sanity', -10);
                    changeStat('corruption', 10);
                }},
                { text: "æ‹’çµ•ä»£æ”¶", action: () => {
                    log("ä½ æŒ‡äº†æŒ‡è¦å‰‡ç‰Œã€‚ä»–è½‰èº«èµ°é€²é»‘æš—ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "ä¸ç†æœƒ", action: () => {
                    log("ä»–åœ¨é–€å£ç«™äº†æ•´æ•´ä¸€å°æ™‚ã€‚", "danger");
                    changeStat('sanity', -15);
                }}
            ]
        },
        "laundry_red": {
            text: "æ´—è¡£æˆ¿åœ°ä¸Šæ‰”è‘—ä¸€ä»¶é®®ç´…è‰²çš„é€£è¡£è£™ï¼Œä¸Šé¢ä¼¼ä¹é‚„æ®˜ç•™è‘—é«”æº«ã€‚",
            choices: [
                { text: "ç”¨æ‰‹é›»ç­’ç¢ºèª", reqClue: "item_flashlight", action: () => {
                    log("å¼·å…‰ç…§å°„ä¸‹ï¼Œé‚£åªæ˜¯æ™®é€šè£™å­ã€‚ä½ é¬†äº†ä¸€å£æ°£ã€‚", "success");
                    changeStat('sanity', -5);
                }},
                { text: "ç‡’æ‰å®ƒ", action: () => {
                    log("ä½ ç‡’äº†è¡£æœï¼Œç«ç„°å‘ˆç¾è©­ç•°çš„ç¶ è‰²ã€‚éš”å¤©è½èªªæœ‰å¥³ä½æˆ¶è©›å’’å·è¡£æœçš„äººã€‚", "danger");
                    changeStat('corruption', 15);
                }},
                { text: "ç„¡è¦–é›¢é–‹", action: () => {
                    log("ä½ è½‰èº«é›¢é–‹ï¼ŒèƒŒå¾Œå‚³ä¾†çª¸çª¸çª£çª£çš„ç©¿è¡£è²ï¼Œä½†ä½ ä¸æ•¢å›é ­ã€‚", "event");
                    changeStat('sanity', -10);
                }}
            ]
        },
        "elevator_maintain": {
            text: "é›»æ¢¯é¡¯ç¤ºã€ç¶­ä¿®ä¸­ã€ï¼Œç´…è‰²çš„æŒ‡ç¤ºç‡ˆç˜‹ç‹‚é–ƒçˆï¼Œè£¡é¢å‚³ä¾†æœ‰ç¯€å¥çš„æ•²æ“Šè²ã€‚",
            choices: [
                { text: "æŒ‰é–‹é–€éµ", action: () => {
                    log("é–€æ‰“é–‹äº†ï¼Œé›»æ¢¯å…§å£é•·æ»¿äº†çœ¼ç›ï¼Œæ‰€æœ‰çš„çœ¼çƒåŒæ™‚è½‰å‘ä½ çœ‹è‘—ä½ ã€‚", "danger");
                    changeStat('sanity', -40);
                }},
                { text: "é–‰çœ¼é»˜æ•¸é›¢é–‹", action: () => {
                    log("æ•²æ“Šè²è®Šæˆäº†å°–éŠ³çš„æŠ“æ’“è²ã€‚ä½ è½‰èº«è·‘å›æ¨“æ¢¯é–“ï¼Œç›´åˆ°è²éŸ³æ¶ˆå¤±ã€‚", "success");
                    changeStat('sanity', -10);
                    changeStat('stamina', -5);
                }},
                { text: "æ•²é–€å›æ‡‰", action: () => {
                    log("è²éŸ³åœæ­¢äº†ã€‚é–€ç¸«å‚³ä¾†ä¸€è²ä½èªï¼šã€æˆ‘è½è¦‹ä½ äº†ã€‚ã€", "danger");
                    changeStat('corruption', 20);
                    changeStat('sanity', -20);
                }}
            ]
        },
        "manager_id": {
            text: "ä½ åœ¨åœ°ä¸Šæ’¿åˆ°ç¶“ç†è­˜åˆ¥è­‰ã€‚ç…§ç‰‡ä¸Šçš„ä»–å¸¶è‘—é®®ç´…è‰²è­˜åˆ¥è­‰ï¼Œå˜´è§’å’§åˆ°äº†è€³æ ¹ã€‚",
            choices: [
                { text: "äº¤çµ¦ç¶“ç†", action: () => {
                    log("ä»–æ¥éè­‰ä»¶ç¬‘äº†ï¼šã€é€™æ˜¯æˆ‘éºå¤±çš„è‡‰ã€‚ã€éš¨å¾Œä»–çš„äº”å®˜é–‹å§‹ä½ç§»ã€‚", "danger");
                    changeStat('sanity', -30);
                }},
                { text: "ä¸Ÿé€²åƒåœ¾æ¡¶", action: () => {
                    log("æ²’éå¤šä¹…ï¼Œè­˜åˆ¥è­‰åˆå‡ºç¾åœ¨ä½ å£è¢‹è£¡ï¼Œè€Œä¸”è®Šå¾—æ¿•é»ã€‚", "danger");
                    changeStat('sanity', -15);
                    changeStat('corruption', 10);
                }},
                { text: "æ’•æ¯€è­‰ä»¶", action: () => {
                    log("é è™•å‚³ä¾†ä¸€è²æ…˜å«ã€‚ç¶“ç†ä»Šæ™šä¼¼ä¹ä¸æœƒå†å‡ºç¾äº†ã€‚", "success");
                    changeStat('sanity', 10);
                }}
            ]
        },
        "vending_leaking": {
            text: "è²©è³£æ©Ÿçš„ä¸€ç½è—è‰²é£²æ–™æ­£åœ¨æ»²å‡ºç´…è‰²é»æ¶²ï¼Œæ•£ç™¼è‘—éµé½å‘³ã€‚",
            choices: [
                { text: "å†’éšªå–ä¸‹", action: () => {
                    if (Math.random() > 0.5) {
                        log("å±…ç„¶æ˜¯è”“è¶Šè“æ±ï¼Ÿçœ‹ä¾†é‹æ°£ä¸éŒ¯ï¼Œä½ ç¨å¾®æ¢å¾©äº†é«”åŠ›ã€‚", "success");
                        changeStat('sanity', 10);
                        changeStat('stamina', 5);
                    } else {
                        log("å…¥å£å…¨æ˜¯è¡€è…¥å‘³ã€‚ä½ çœ‹å‘ç½å­ï¼Œä¸Šé¢å¯«è‘—ã€è—è¡€ã€ï¼Œä½ æ„Ÿåˆ°ä¸€é™£å™å¿ƒã€‚", "danger");
                        changeStat('corruption', 25);
                        changeStat('sanity', -15);
                    }
                }},
                { text: "ä¸å–", action: () => {
                    log("é‚£è‚¡ç”œè…¥å‘³æ®ä¹‹ä¸å»ï¼Œä½ å¿«æ­¥é›¢é–‹äº†ã€‚", "event");
                }}
            ]
        },
        "manager_choice": {
            text: "ç¶“ç†ç«™åœ¨èµ°å»Šç›¡é ­ï¼Œä»–çš„è„–å­ä¸Šç©ºç©ºå¦‚ä¹Ÿï¼Œæ‰‹è£¡æ‹¿è‘—ç´…è—å…©æ¢è­˜åˆ¥è­‰å•ï¼šã€ä»Šæ™šæˆ‘è©²æˆ´å“ªæ¢ï¼Ÿã€",
            choices: [
                { text: "é¸è—è‰²", action: () => {
                    log("ã€å¥½å“å‘³ã€‚ã€ä»–å°‡è—è­˜åˆ¥è­‰æ›åœ¨ç©ºæ°£ä¸­ï¼Œæ»¿æ„åœ°é›¢é–‹äº†ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "é¸ç´…è‰²", action: () => {
                    log("ä»–è¡éä¾†ï¼ŒæŠŠç´…è­˜åˆ¥è­‰æ­»æ­»å‹’åœ¨ä½ è„–å­ä¸Šã€‚", "danger");
                    changeStat('stamina', -40);
                }},
                { text: "æ²‰é»˜ä¸èª", action: () => {
                    log("ä»–å¤±æœ›åœ°æ–æ–é ­ï¼Œæ¶ˆå¤±åœ¨é»‘æš—ä¸­ã€‚", "event");
                    changeStat('sanity', -5);
                }}
            ]
        },
        "cleaner_green": {
            text: "ä½ ç¶“éæ´—æ‰‹é–“ï¼Œé¡å­æ˜ å‡ºä¸€å€‹ç©¿ç¶ è‰²åˆ¶æœçš„äººå½±ï¼Œæ­£èƒŒå°è‘—ä½ æ‹–åœ°ã€‚",
            choices: [
                { text: "æ‰“ç ´é¡å­", action: () => {
                    log("ä½ ç ¸ç¢äº†é¡å­ã€‚é‚£å€‹æ¸…æ½”å·¥éŒ¯æ„•åœ°çœ‹è‘—ä½ ã€‚ä½ å¥½åƒåªæ˜¯æµªè²»äº†é«”åŠ›ã€‚", "event");
                    changeStat('stamina', -15);
                    changeStat('sanity', -5);
                }},
                { text: "æ‰“æ‹›å‘¼", action: () => {
                    log("ä»–è½‰éé ­ï¼Œåªæ˜¯ä¸€å€‹æ™®é€šçš„å¤§å”ã€‚çœ‹ä¾†æ˜¯ä½ å¤ªç·Šå¼µäº†ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "é€ƒè·‘", action: () => {
                    log("ä½ ä¸€å£æ°£è·‘åˆ°ä¸‹ä¸€å±¤ï¼Œå…¶å¯¦ä»€éº¼äº‹éƒ½æ²’ç™¼ç”Ÿã€‚", "event");
                    changeStat('stamina', -5);
                }}
            ]
        },
        "room_403_party": {
            text: "403è™Ÿæˆ¿å¤§é–€æ•é–‹ï¼Œè£¡é¢å‚³ä¾†ç†±é¬§çš„éŸ³æ¨‚è²å’Œäººç¾¤çš„æ­¡ç¬‘è²ã€‚",
            choices: [
                { text: "åŠ å…¥æ´¾å°", action: () => {
                    log("ä½ èµ°é€²æˆ¿é–“ï¼ŒéŸ³æ¨‚æˆ›ç„¶è€Œæ­¢ã€‚æˆ¿é–“è£¡å…¨æ˜¯æ–·è‚¢çš„äººé«”æ¨¡å‹ã€‚", "danger");
                    changeStat('sanity', -15);
                }},
                { text: "é—œä¸Šé–€", action: () => {
                    log("ä½ ç”¨åŠ›é—œä¸Šé–€ã€‚éŸ³æ¨‚ç¬é–“æ¶ˆå¤±ï¼Œèµ°å»Šé‡æ­¸æ­»å¯‚ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "ä½é ­é€šé", action: () => {
                    log("ä½ æ„Ÿè¦ºèƒŒä¸Šæœ‰ç„¡æ•¸é“è¦–ç·šåœ¨ç›¯è‘—ä½ ï¼Œç›´åˆ°ä½ è½‰éè½‰è§’ã€‚", "event");
                }}
            ]
        },
        "vending_purple": {
            text: "è²©è³£æ©Ÿè£¡çªç„¶å‡ºç¾ä¸€ç½ç™¼è‘—å¾®å¼±è¢å…‰çš„ç´«è‰²é£²æ–™ï¼Œä½ å¾æœªè¦‹éé€™å€‹ç‰Œå­ã€‚",
            choices: [
                { text: "å–ä¸‹å»", action: () => {
                    log("å‘³é“åƒè—è“æ··åˆè‘—éµé½ã€‚ä½ çš„é ­è…¦è®Šå¾—ç•°å¸¸æ¸…æ™°ï¼Œä½†èƒƒè£¡ä¼¼ä¹æœ‰æ±è¥¿åœ¨è •å‹•ã€‚", "success");
                    changeStat('sanity', 10);
                    changeStat('corruption', 15);
                }},
                { text: "ä¸å–", action: () => {
                    log("ä½ ç¸½è¦ºå¾—è‡ªå·±éŒ¯éäº†ä»€éº¼é‡è¦çš„æ±è¥¿ã€‚", "event");
                }}
            ]
        },
        "manager_scarf": {
            text: "ç¶“ç†ä»Šå¤©åœè‘—ä¸€æ¢åšé‡çš„åœå·¾ï¼Œå®Œå…¨é®ä½äº†è„–å­éƒ¨ä½ã€‚",
            choices: [
                { text: "ç¦®è²Œå•å¥½", action: () => {
                    if (Math.random() > 0.5) {
                        log("ä»–è§£é–‹åœå·¾é€æ°£ï¼Œéœ²å‡ºäº†è£¡é¢çš„ç´…è­˜åˆ¥è­‰ã€‚", "danger");
                        changeStat('stamina', -30);
                    } else {
                        log("é¢¨å¹èµ·åœå·¾ä¸€è§’ï¼Œä½ çœ‹åˆ°äº†è—è‰²çš„è­˜åˆ¥è­‰ï¼Œä½ é¬†äº†ä¸€å£æ°£ã€‚", "success");
                        changeStat('sanity', 5);
                    }
                }},
                { text: "å‡è£æ²’çœ‹è¦‹", action: () => {
                    log("ç¶“ç†ç¶“éä½ èº«é‚Šæ™‚ä½è²èªªï¼šã€ç®—ä½ é‹æ°£å¥½ã€‚ã€", "event");
                    changeStat('sanity', -5);
                }},
                { text: "ç¨±è®šåœå·¾", action: () => {
                    log("ä»–çœ‹èµ·ä¾†å¾ˆé«˜èˆˆã€‚é€™æ‡‰è©²æ˜¯å®‰å…¨çš„ã€‚", "success");
                    changeStat('sanity', 5);
                }}
            ]
        },
        "elevator_mirror": {
            text: "é›»æ¢¯åœåœ¨B1ï¼Œä½ å¾é›»æ¢¯è£¡çš„é¡å­çœ‹åˆ°é–€å¤–ä¼¼ä¹ç«™è‘—ä¸€å€‹ç´…è‰²çš„æ±è¥¿ã€‚",
            choices: [
                { text: "å …æŒé–‰çœ¼", action: () => {
                    log("è€³é‚Šå‚³ä¾†ç»ç’ƒç¢è£‚çš„è²éŸ³ï¼Œä½†ä½ ç·Šé–‰é›™çœ¼ã€‚éäº†ä¸€æœƒå…’ï¼Œé›»æ¢¯é–€é—œä¸Šäº†ã€‚å®‰å…¨ã€‚", "success");
                    changeStat('sanity', -10);
                }},
                { text: "çœçœ¼æª¢æŸ¥", action: () => {
                    log("é¡å­è£¡ï¼Œä¸€å€‹ç©¿ç´…åˆ¶æœçš„ç„¡è‡‰äººæ­£æ­»æ­»ç›¯è‘—ä½ ã€‚", "danger");
                    changeStat('sanity', -30);
                }}
            ]
        },
        "stray_dog_shadow": {
            text: "èµ°å»Šçš„ç‡ˆå…‰å°‡ä½ çš„å½±å­æ‹‰å¾—å¾ˆé•·ï¼Œç‰†ä¸ŠæŠ•å°„å‡ºä¸€å€‹åƒå·¨å¤§çµçŠ¬çš„å½±å­ï¼Œä¸¦å‚³ä¾†æ²‰é‡çš„å–˜æ¯è²ã€‚",
            choices: [
                { text: "é—œé–‰å…‰æº", action: () => {
                    log("ä½ é—œæ‰æ‰‹é›»ç­’ã€‚å–˜æ¯è²åœ¨å‘¨åœå¾˜å¾Šäº†ä¸€é™£å¾Œé å»äº†ã€‚", "success");
                    changeStat('sanity', -5);
                }},
                { text: "ç”¨æ‰‹é›»ç­’é©…è¶•", reqClue: "item_flashlight", action: () => {
                    log("å½±å­æ¶ˆå¤±äº†ï¼Œä½†ä½ ç™¼ç¾è‡ªå·±çš„å½±å­å¤šäº†ä¸€æ¢å°¾å·´ã€‚", "danger");
                    changeStat('corruption', 20);
                    changeStat('sanity', -15);
                }}
            ]
        },
        "fake_rule_note": {
            text: "ç›£æ§è¢å¹•ä¸Šè²¼è‘—ä¸€å¼µé»ƒè‰²ä¾¿åˆ©è²¼ï¼Œç­†è·¡æ½¦è‰ï¼šã€è¦å‰‡12ï¼šè«‹å°é¡é ­å¾®ç¬‘ï¼Œå¦å‰‡å®ƒå€‘æœƒç™¼ç¾ä½ çœ‹å¾—è¦‹ã€‚ã€",
            choices: [
                { text: "å°é¡é ­å¾®ç¬‘", action: () => {
                    log("ä½ çœ‹è‘—é¡é ­è£¡è‡ªå·±åƒµç¡¬æ„šè ¢çš„ç¬‘å®¹ï¼Œæ„Ÿåˆ°å¼·çƒˆçš„è‡ªæˆ‘å­æƒ¡ã€‚", "event");
                    changeStat('sanity', -10);
                }},
                { text: "æ’•æ‰ç´™æ¢", action: () => {
                    log("é€™åªæ˜¯ç„¡èŠçš„æƒ¡ä½œåŠ‡ã€‚ä½ æŠŠå®ƒæ‰æˆä¸€åœ˜ä¸Ÿäº†ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "æª¢æŸ¥å›æ”¾", action: () => {
                    log("ä½ èª¿å‡ºéŒ„å½±ï¼Œç™¼ç¾å¾é ­åˆ°å°¾åªæœ‰ä½ ä¸€å€‹äººåœ¨ä¿å®‰å®¤...é‚£æ˜¯èª°è²¼çš„ï¼Ÿ", "danger");
                    changeStat('sanity', -20);
                }}
            ]
        },
        "toy_dog": {
            text: "å¤§å»³ç©ºç„¡ä¸€äººï¼Œå»çªç„¶å‚³ä¾†ã€æ±ªï¼ã€çš„ä¸€è²ï¼Œä½ ä½é ­çœ‹åˆ°ä¸€éš»ç™¼æ¢æ©Ÿæ¢°ç‹—ã€‚",
            choices: [
                { text: "é—œæ‰å®ƒ", action: () => {
                    log("ä½ çš„æ‰‹æŒ‡å‰›ç¢°åˆ°é–‹é—œï¼Œå®ƒçŒ›åœ°å’¬äº†ä½ ä¸€å£ï¼", "event");
                    changeStat('stamina', -10);
                }},
                { text: "ç”¨æ‰‹é›»ç­’ç…§å®ƒ", reqClue: "item_flashlight", action: () => {
                    log("åœ¨å¼·å…‰ä¸‹ï¼Œç™¼æ¢åœæ­¢äº†è½‰å‹•ã€‚é€™åªæ˜¯å€‹æ™®é€šçš„ç©å…·ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "èº²å›ä¿å®‰å®¤", action: () => {
                    log("ç©å…·ç‹—å™ å™ å™ åœ°èµ°é€²é»‘æš—ï¼Œéš¨å¾Œç™¼å‡ºäº†ä¸€è²åƒäººé¡æ…˜å«çš„è²éŸ³ã€‚", "danger");
                    changeStat('sanity', -15);
                }}
            ]
        },
        "green_drink": {
            text: "è²©è³£æ©Ÿå“å™¹ä¸€è²åå‡ºä¸€ç½æ²’æœ‰æ¨™ç±¤çš„ç¶ è‰²é£²æ–™ã€‚",
            choices: [
                { text: "å–æ‰å®ƒ", action: () => {
                    const outcome = Math.random();
                    if (outcome > 0.5) {
                        log("å±…ç„¶æ˜¯å“ˆå¯†ç“œæ±½æ°´ï¼Ÿå–å®Œå¾Œç²¾ç¥å¥½å¤šäº†ã€‚", "success");
                        changeStat('stamina', 20);
                        changeStat('sanity', 10);
                    } else {
                        log("å–èµ·ä¾†åƒæ˜¯ç‡ƒç‡’çš„é›»æ± æ¶²ï¼Œä½ çš„é£Ÿé“åŠ‡ç—›ä¸å·²ã€‚", "danger");
                        changeStat('stamina', -20);
                        changeStat('corruption', 10);
                    }
                }},
                { text: "ç„¡è¦–", action: () => {
                    log("ä½ æ²’æœ‰ç†æœƒã€‚å†æ¬¡å›é ­æ™‚ï¼Œé£²æ–™å·²ç¶“ä¸è¦‹äº†ã€‚", "event");
                }}
            ]
        },
        "neighbor_405": {
            text: "405è™Ÿæˆ¿çš„ä½æˆ¶æ†¤æ€’åœ°è¡å‡ºä¾†å¼é“ï¼šã€éš”å£404åµæ­»äº†ï¼ä½ å€‘ä¿å®‰éƒ½ä¸ç®¡ç®¡å—ï¼Ÿã€",
            choices: [
                { text: "ç­”æ‡‰æŸ¥çœ‹", action: () => {
                    log("ä½ å»æ•²äº†404çš„é–€ï¼Œé–€é–‹äº†ï¼Œè£¡é¢æ˜¯ç„¡ç›¡çš„æ·±æ·µã€‚", "danger");
                    changeStat('sanity', -20);
                    changeStat('stamina', -10);
                }},
                { text: "å‘ŠçŸ¥404æ²’äºº", action: () => {
                    log("ä½æˆ¶çš„è‡‰è‰²ç¬é–“è®Šå¾—æ…˜ç™½ï¼Œä»€éº¼éƒ½æ²’èªªå°±è·‘å›äº†æˆ¿é–“ã€‚", "event");
                    changeStat('sanity', -5);
                    changeStat('corruption', 5);
                }},
                { text: "ä¿æŒæ²‰é»˜", action: () => {
                    log("ä½æˆ¶ç½µç½µå’§å’§äº†ä¸€å¥ï¼Œè½‰èº«å›å»äº†ã€‚", "success");
                }}
            ]
        },
        "neighbor_knock": {
            text: "å°è¬›æ©Ÿçªç„¶éŸ¿èµ·ï¼šã€æˆ‘æ˜¯302çš„ä½æˆ¶ï¼Œæˆ‘å¿˜å¸¶é‘°åŒ™äº†ï¼Œå¹«æˆ‘é–‹ä¸€ä¸‹å¤§é–€ï¼ã€",
            choices: [
                { text: "å¹«å¥¹é–‹é–€", action: () => {
                    log("é–€é–‹äº†ã€‚å¹¾ç§’é˜å¾Œï¼Œå¥¹å‡ºç¾åœ¨ä½ èº«å¾Œï¼Œçµ¦äº†ä½ ç‹ ç‹ ä¸€çˆªã€‚", "danger");
                    changeStat('stamina', -30);
                    changeStat('sanity', -20);
                }},
                { text: "æ‹’çµ•ä¸¦æª¢æŸ¥åå–®", action: () => {
                    log("ä½ æŸ¥äº†åå†Šï¼Œ302æ ¹æœ¬æ²’ä½äººã€‚å°è¬›æ©Ÿé‚£é ­å‚³ä¾†é‡ç¸èˆ¬çš„ä½å¼ã€‚", "success");
                    changeStat('sanity', -5);
                }},
                { text: "è©¢å•ç‰¹å¾µ", action: () => {
                    log("ã€æˆ‘æœ‰...ç´…è‰²çš„çœ¼ç›...ã€è²éŸ³é–‹å§‹æ‰­æ›²è®Šå½¢ã€‚", "danger");
                    changeStat('sanity', -15);
                }}
            ]
        },
        "restock_man": {
            text: "ä½ çœ‹è¦‹æœ‰äººåœ¨çµ¦è²©è³£æ©Ÿè£œè²¨ï¼Œä½†ä»–è£œé€²å»çš„å…¨æ˜¯é®®ç´…è‰²çš„ç½å­ã€‚",
            choices: [
                { text: "è³ªå•", action: () => {
                    log("ä»–è½‰éé ­ï¼Œè‡‰ä¸Šæ²’æœ‰äº”å®˜ï¼Œåªæœ‰ä¸€å¼µå·¨å¤§çš„å˜´ã€‚", "danger");
                    changeStat('sanity', -20);
                    changeStat('stamina', -10);
                }},
                { text: "å‡è£æ²’çœ‹è¦‹", action: () => {
                    log("ç­‰ä½ å†çœ‹éå»ï¼Œäººå·²ç¶“æ¶ˆå¤±äº†ï¼Œè²©è³£æ©Ÿè£¡å¡æ»¿äº†è¡€ç´…è‰²çš„ç½å­ã€‚", "event");
                    changeStat('sanity', -5);
                }},
                { text: "è²·ä¸€ç½", action: () => {
                    log("æ¶²é«”æ¿ºåˆ°æ‰‹ä¸Šï¼Œè…è•äº†ä½ çš„çš®è†šã€‚", "danger");
                    changeStat('stamina', -20);
                }}
            ]
        },
        "extra_floor": {
            text: "ä½ èµ°é€²é›»æ¢¯ï¼Œç™¼ç¾æ§åˆ¶é¢æ¿ä¸Šå¤šäº†ä¸€å€‹å¯«è‘—ã€14Fã€çš„æŒ‰éˆ•ã€‚",
            choices: [
                { text: "å¥½å¥‡æŒ‰ä¸‹", action: () => {
                    log("é›»æ¢¯ä¸Šå‡åˆ°äº†ä¸å­˜åœ¨çš„æ¨“å±¤ã€‚ç¼ºæ°§æ„Ÿè®“ä½ å¹¾ä¹æšˆå¥ã€‚", "danger");
                    changeStat('stamina', -30);
                    changeStat('sanity', -20);
                }},
                { text: "ç„¡è¦–é›¢é–‹", action: () => {
                    log("ä½ é¸æ“‡èµ°æ¨“æ¢¯é›¢é–‹ã€‚é€™æœ€å®‰å…¨ã€‚", "success");
                    changeStat('stamina', -5);
                }},
                { text: "æ‹ç…§", action: () => {
                    log("ä½ æ‹äº†å¼µç…§ã€‚ç…§ç‰‡é¡¯ç¤ºé›»æ¢¯è£¡å…¶å¯¦ç«™æ»¿äº†äººã€‚", "danger");
                    changeStat('sanity', -25);
                    changeStat('corruption', 10);
                }}
            ]
        },
        "red_tie_gift": {
            text: "ä¿å®‰å®¤çš„æ¡Œä¸Šçªç„¶å‡ºç¾ä¸€å€‹ç²¾ç¾çš„ç¦®ç›’ï¼Œè£¡é¢æœ‰ä¸€æ¢ç´…è­˜åˆ¥è­‰å’Œä¸€å¼µå¡ç‰‡ï¼šã€åŠ å…¥æˆ‘å€‘ã€‚â€”â€”ç¶“ç†ã€",
            choices: [
                { text: "æˆ´ä¸Šè­˜åˆ¥è­‰", action: () => {
                    log("ä½ å‰›æˆ´ä¸Šï¼Œè­˜åˆ¥è­‰å°±è‡ªå‹•æ”¶ç·Šï¼Œå½·å½¿è¦å‹’æ–·ä½ çš„è„–å­ã€‚", "danger");
                    changeStat('stamina', -30);
                }},
                { text: "æ‰”é€²åƒåœ¾æ¡¶", action: () => {
                    log("ä½ å‰›è½‰èº«ï¼Œå®ƒåˆå‡ºç¾åœ¨æ¡Œä¸Šã€‚ä½ ä¸æ•¢å†ç¢°å®ƒäº†ã€‚", "event");
                    changeStat('sanity', -10);
                    changeStat('corruption', 5);
                }}
            ]
        },
        "glitch_anomaly": {
            text: "èµ°å»Šå‰æ–¹æ‡¸æµ®è‘—ä¸€åœ˜å¹¾ä½•ç‹€çš„é»‘éœ§ï¼Œå‘¨åœçš„ç©ºé–“ä¼´éš¨è‘—å¼·çƒˆçš„æ•¸ä½é›œè¨Šåœ¨è·³å‹•ã€‚",
            choices: [
                { text: "ç¹é“", action: () => {
                    log("ä½ å°å¿ƒç¿¼ç¿¼åœ°ç¹éäº†å®ƒï¼Œæ²’æœ‰ç™¼ç”Ÿç•°ç‹€ã€‚", "success");
                    changeStat('sanity', -5);
                    changeStat('stamina', -5);
                }},
                { text: "è§¸ç¢°", action: () => {
                    log("æŒ‡å°–å‰›ç¢°åˆ°ï¼Œç„¡æ•¸æ··äº‚çš„ç•«é¢ç¬é–“å¡æ»¿ä½ çš„å¤§è…¦ã€‚", "danger");
                    changeStat('sanity', -25);
                    changeStat('corruption', 15);
                }},
                { text: "è†è½è²éŸ³", condition: () => GameState.day >= 4, action: () => {
                    log("ä½ è½åˆ°äº†ä¾†è‡ªåœ°ç„çš„é »ç‡ï¼Œè€³æœµé–‹å§‹æµè¡€ã€‚", "danger");
                    changeStat('stamina', -20);
                    changeStat('sanity', -20);
                }}
            ]
        },
        "room_404_encounter": {
            text: "ä½ å·¡é‚ç¶“é404è™Ÿæˆ¿ï¼Œé–€ç¸«é€å‡ºè©­ç•°çš„ç´…å…‰ï¼Œè£¡é¢å‚³ä¾†æŒ‡ç”²æŠ“æ’“é–€æ¿çš„è²éŸ³ã€‚",
            choices: [
                { text: "çœ‹ä¸€çœ¼", action: () => {
                     log("ç´…å…‰åˆºå…¥ä½ çš„çœ¼ç›ï¼Œçœ¼çƒåŠ‡ç—›ç„¡æ¯”ã€‚", "danger");
                     changeStat('stamina', -20);
                     changeStat('sanity', -20);
                }},
                { text: "ä½é ­é€šé", action: () => {
                    log("é–€åœ¨ä½ èº«å¾Œç °åœ°ä¸€è²é—œä¸Šäº†ã€‚ä½ æ²’æœ‰å›é ­ã€‚", "success");
                    changeStat('sanity', -5);
                    changeStat('stamina', -5);
                }},
                { text: "å¹«å¿™é—œé–€", action: () => {
                    log("ä¸€éš»å†°å†·çš„æ‰‹çªç„¶å¾é–€ç¸«ä¼¸å‡ºæŠ“ä½äº†ä½ ï¼", "danger");
                    changeStat('stamina', -20);
                    changeStat('corruption', 10);
                }}
            ]
        },
        "phantom_pet": {
            text: "æ¼†é»‘çš„æ¨“æ¢¯è§’å‚³ä¾†å¾®å¼±çš„è²“å«è²ï¼Œè½èµ·ä¾†éå¸¸å¯æ†ã€‚",
            choices: [
                { text: "æŸ¥çœ‹", action: () => {
                    log("æ‰‹é›»ç­’ç…§éå»ï¼Œé‚£éš»è²“é•·è‘—ä¸€å¼µè’¼ç™½çš„äººè‡‰ã€‚", "danger");
                    changeStat('sanity', -20);
                }},
                { text: "é—œç‡ˆå®‰éœ", action: () => {
                    log("ä½ é—œæ‰ç‡ˆå±ä½å‘¼å¸ã€‚éäº†ä¸€æœƒï¼Œå®ƒé›¢é–‹äº†ã€‚", "success");
                    changeStat('sanity', -5);
                }},
                { text: "çµ¦ç½é ­", condition: () => GameState.day >= 4, action: () => {
                    log("å®ƒæ²’æœ‰åƒç½é ­ï¼Œè€Œæ˜¯å’¬äº†ä½ çš„æ‰‹ã€‚", "danger");
                    changeStat('stamina', -20);
                }}
            ]
        },
        "noise_upstairs": {
            text: "æ·±å¤œçš„æ¨“æ¿ä¸Šæ–¹å‚³ä¾†æ¸…è„†çš„å½ˆç æ»¾å‹•è²...å™ ã€å™ ã€å™ ...è²éŸ³å¾è‡¥å®¤ä¸Šæ–¹ä¸€è·¯æ»¾åˆ°äº†å®¢å»³ï¼Œä½†ä½ è¨˜å¾—æ¨“ä¸Šæ ¹æœ¬æ²’æœ‰ä½äººã€‚",
            choices: [
                { text: "ä¸Šæ¨“æŸ¥çœ‹", action: () => {
                    log("ä½ å‰›ä¸Šæ¨“æ¢¯ï¼Œå°±æœ‰äººå¾èƒŒå¾Œç”¨åŠ›æ¨äº†ä½ ä¸€æŠŠï¼", "danger");
                    changeStat('sanity', -20);
                    changeStat('stamina', -15);
                    changeStat('corruption', 5);
                }},
                { text: "æˆ´ä¸Šè€³æ©Ÿ", action: () => {
                    log("è²éŸ³è½ä¸åˆ°äº†ï¼Œä½†ä½ ç¸½è¦ºå¾—èƒŒå¾Œæœ‰äººåœ¨å°ä½ å¹æ°£ã€‚", "event");
                    changeStat('sanity', -10);
                }}
            ]
        },
        "elevator_b1": {
            text: "é›»æ¢¯é–€ç„¡è²æ»‘é–‹ï¼Œé¡¯ç¤ºæ¨“å±¤ç‚ºB1ã€‚è£¡é¢ä¸€ç‰‡æ¼†é»‘ï¼Œå½·å½¿é€£å…‰ç·šéƒ½è¢«åå™¬äº†ï¼Œæ·±è™•å‚³ä¾†æ½®æ¿•çš„è…è‡­å‘³ã€‚",
            choices: [
                { text: "èµ°é€²å»", action: () => {
                    log("ä½ å‰›è¸é€²å»ï¼Œé›»æ¢¯é–‹å§‹æ€¥é€Ÿä¸‹å¢œï¼Œå½·å½¿æ²’æœ‰åº•ã€‚", "danger");
                    changeStat('sanity', -30);
                    changeStat('stamina', -20);
                }},
                { text: "é»˜æ•¸10ç§’", action: () => {
                    log("ä½ é–‰çœ¼æ•¸åˆ°10ã€‚å†çœçœ¼æ™‚é–€é—œä¸Šäº†ï¼Œæ²‰é‡çš„å‘¼å¸è²å°±åœ¨é¼»å°–æ¶ˆå¤±ã€‚", "success");
                    changeStat('sanity', -15);
                }},
                { text: "é€ƒè·‘", condition: () => GameState.stamina > 25, action: () => {
                    log("ä½ ç‹‚å¥”å›ä¿å®‰å®¤ï¼Œé–ä¸Šäº†é–€ã€‚", "event");
                    changeStat('stamina', -25);
                }}
            ]
        },
        "phone_call": {
            text: "å¯‚éœçš„ä¿å®‰å®¤è£¡ï¼Œé‚£å°æ—©å·²æ‹”æ‰ç·šè·¯çš„å…§ç·šé›»è©±çªç„¶ç™¼å‡ºåˆºè€³çš„éˆ´è²ï¼Œç´…è‰²çš„ä¿¡è™Ÿç‡ˆç˜‹ç‹‚é–ƒçˆã€‚",
            choices: [
                { text: "æ¥èµ·", action: () => {
                    if (Math.random() < 0.5) {
                        log("è©±ç­’è£¡å‚³ä¾†ä½ è‡ªå·±çš„è²éŸ³ï¼šã€åˆ¥å›é ­...ã€", "danger");
                        changeStat('sanity', -25);
                    } else {
                        log("åˆºè€³çš„å°–å«è²å¹¾ä¹åˆºç ´ä½ çš„è€³è†œï¼", "danger");
                        changeStat('sanity', -15);
                        changeStat('stamina', -10);
                    }
                }},
                { text: "æ‹”æ‰é›»è©±ç·š", action: () => {
                    log("ä½ æ‹”æ‰äº†ç·šï¼Œä½†éˆ´è²åˆéŸ¿äº†æ•´æ•´ä¸‰è²æ‰åœä¸‹ã€‚", "event");
                    changeStat('sanity', -10);
                    changeStat('corruption', 5);
                }}
            ]
        },
        "vending_machine": {
            text: "èµ°å»Šç›¡é ­çš„è²©è³£æ©Ÿç‡ˆå…‰å¿½æ˜å¿½æš—ï¼Œç™¼å‡ºå—¡å—¡çš„é›»æµè²ã€‚",
            choices: [
                { text: "è²·è—è‰²é£²æ–™", action: () => {
                    if (GameState.day >= 4) {
                        log("é£²æ–™æ»¾å‡ºä¾†ï¼Œè£¡é¢æ¼‚æµ®è‘—ä¸€é¡†çœ¼çƒã€‚", "danger");
                        changeStat('sanity', -15);
                        changeStat('corruption', 10);
                    } else {
                        log("å†°æ¶¼çš„é£²æ–™è®“ä½ ç²¾ç¥ä¸€æŒ¯ã€‚", "success");
                        changeStat('stamina', 15);
                        changeStat('sanity', 5);
                    }
                }},
                { text: "è²·ç´…è‰²é£²æ–™", action: () => {
                     log("å–èµ·ä¾†åƒè¡€...ä½†ç•°å¸¸é¦™ç”œï¼Œä½ å¿ä¸ä½æƒ³å†å–ä¸€ç½ã€‚", "danger");
                     changeStat('corruption', 40);
                     changeStat('sanity', -30);
                }},
                { text: "è¸¢ä¸€ä¸‹æ©Ÿå°", action: () => {
                    log("å“å™¹ï¼æ‰ä¸‹ä¾†ä¸€ç½ç”Ÿé½çš„ç¶ è‰²ç½å­ã€‚", "event");
                    changeStat('stamina', -5);
                }}
            ]
        },
        "midnight_delivery": {
            text: "æš´é›¨å¤œï¼Œä¸€å€‹ç©¿è‘—é»ƒè‰²é›¨è¡£çš„äººç«™åœ¨ç»ç’ƒé–€å¤–ï¼ŒæŒ‡è‘—åœ°ä¸Šçš„åŒ…è£¹ç¤ºæ„ä½ ç°½æ”¶ã€‚",
            choices: [
                { text: "é–‹é–€", action: () => {
                    log("é–€å‰›é–‹ï¼Œå®ƒå°±åŒ–ä½œä¸€æ”¤é»‘æ³¥è¡äº†é€²ä¾†ã€‚", "danger");
                    changeStat('stamina', -30);
                    changeStat('corruption', 20);
                }},
                { text: "æ‹’çµ•", action: () => {
                    log("å®ƒåƒµç¡¬åœ°é»é»é ­ï¼Œæ¶ˆå¤±åœ¨é›¨ä¸­ã€‚", "success");
                    changeStat('sanity', -5);
                }},
                { text: "æŸ¥çœ‹åŒ…è£¹", reqClue: "clue_package", action: () => {
                    log("ä½ æ‹¿å‡ºæ‰‹æ©Ÿæ‹ç…§å­˜è­‰ï¼Œå®ƒä¼¼ä¹è¢«é–ƒå…‰ç‡ˆåš‡è·‘äº†ã€‚", "success");
                    changeStat('sanity', 5);
                }}
            ]
        },
        "cctv_anomaly": {
            text: "ä½ æ³¨æ„åˆ°13æ¨“èµ°å»Šçš„ç›£è¦–å™¨ç•«é¢è£¡ï¼Œæœ‰ä¸€ç¾¤äººæ­£èƒŒå°è‘—é¡é ­ä¸€å‹•ä¹Ÿä¸å‹•ã€‚",
            choices: [
                { text: "ä»”ç´°è§€å¯Ÿ", action: () => {
                    log("çªç„¶ï¼Œæ‰€æœ‰äººåŒæ™‚è½‰éé ­çœ‹å‘é¡é ­ï¼å±å¹•ç¬é–“ç‚¸è£‚ã€‚", "danger");
                    changeStat('sanity', -30);
                    changeStat('corruption', 10);
                }},
                { text: "é—œé–‰è¢å¹•", action: () => {
                    log("ä½ é—œæ‰äº†è¢å¹•ã€‚å¹¾ç§’å¾Œï¼Œé–€å¤–å‚³ä¾†äº†æ•´é½Šçš„è…³æ­¥è²ã€‚", "event");
                    changeStat('sanity', -10);
                    changeStat('stamina', -5);
                }}
            ]
        },
        "hallway_shadow": {
            text: "å·¡é‚æ™‚ï¼Œä½ çœ‹è¦‹èµ°å»Šç›¡é ­ç«™è‘—ä¸€å€‹é«˜å¤§çš„äººå½¢é»‘å½±ï¼Œä¼¼ä¹åœ¨ç­‰å¾…è‘—èª°ã€‚",
            choices: [
                { text: "ç”¨æ‰‹é›»ç­’ç…§", reqClue: "item_flashlight", action: () => {
                    log("å…‰ç·šç…§éå»ï¼Œé‚£è£¡åªæ›è‘—ä¸€ä»¶èˆŠå¤§è¡£ã€‚", "event");
                    changeStat('sanity', -5);
                }},
                { text: "èº²åœ¨æ¡Œä¸‹", action: () => {
                    log("ä½ å±ä½å‘¼å¸ã€‚å®ƒåœ¨é–€å£å¾˜å¾Šäº†ä¸€é™£å¾Œé›¢é–‹äº†ã€‚", "success");
                    changeStat('stamina', -5);
                }}
            ]
        },
        "strange_smell": {
            text: "ç©ºæ°£ä¸­çªç„¶ç€°æ¼«è‘—ä¸€è‚¡ç‡’ç„¦çš„å‘³é“ï¼Œéš±ç´„é‚„èƒ½è½åˆ°ç´°å¾®çš„æ±‚æ•‘è²ã€‚",
            choices: [
                { text: "å°‹æ‰¾ä¾†æº", action: () => {
                    log("ä½ åœ¨è§’è½ç™¼ç¾äº†ä¸€å †æ­£åœ¨ç‡ƒç‡’çš„ç´™éŒ¢ã€‚", "danger");
                    changeStat('sanity', -15);
                    changeStat('corruption', 5);
                }},
                { text: "ç„¡è¦–", action: () => {
                    log("å‘³é“è®“ä½ æ„Ÿåˆ°å¼·çƒˆçš„å™å¿ƒå’Œé ­æšˆã€‚", "event");
                    changeStat('stamina', -10);
                }}
            ]
        },
        "crying_baby": {
            text: "å¤œæ·±äººéœï¼Œä¸çŸ¥å¾å“ªè£¡å‚³ä¾†äº†æ·’å²çš„å¬°å…’å“­è²ï¼Œåœ¨ç©ºè•©çš„èµ°å»Šè¿´ç›ªã€‚",
            choices: [
                { text: "å°‹æ‰¾å“­è²", action: () => {
                    log("ä½ æ‰¾åˆ°äº†ä¸€å€‹è¢«éºæ£„çš„èˆŠæ´‹å¨ƒå¨ƒï¼Œçœ¼ç›è¢«æŒ–ç©ºäº†ã€‚", "event");
                    changeStat('sanity', -10);
                }},
                { text: "æˆ´ä¸Šè€³å¡", action: () => {
                    log("æ²’ç”¨ã€‚å“­è²ç›´æ¥åœ¨ä½ çš„è…¦æµ·æ·±è™•éŸ¿èµ·ã€‚", "danger");
                    changeStat('sanity', -20);
                }}
            ]
        },
        "manager_visit": {
            text: "ç¶“ç†ï¼ˆå¸¶è‘—ç´…è­˜åˆ¥è­‰ï¼‰çªç„¶å‡ºç¾åœ¨çª—å£ï¼Œéçµ¦ä½ ä¸€æ¯æ°´ï¼šã€è¾›è‹¦äº†ï¼Œå–å£æ°´å§ã€‚ã€",
            choices: [
                { text: "å–æ°´", action: () => {
                    log("æ°´åƒå²©æ¼¿ä¸€æ¨£ç¼ç‡’è‘—ä½ çš„å–‰åš¨ã€‚", "danger");
                    changeStat('stamina', -30);
                }},
                { text: "ç„¡è¦–", action: () => {
                    log("ä»–åœ¨çª—å¤–ç£¨ç‰™ï¼Œç™¼å‡ºå’¯å±å’¯å±çš„è²éŸ³ï¼Œæœ€å¾Œé›¢é–‹äº†ã€‚", "success");
                    changeStat('sanity', -15);
                }},
                { text: "è³ªè©¢è­˜åˆ¥è­‰", reqClue: "clue_manager", action: () => {
                    log("è¢«æ‹†ç©¿å¾Œï¼Œä»–åŒ–ä½œä¸€åœ˜é»‘éœ§æ¶ˆæ•£äº†ã€‚", "success");
                    changeStat('sanity', 10);
                }}
            ]
        },
        "lost_girl": {
            text: "ä¸€å€‹ç©¿è‘—ç¡è¡£çš„å°å¥³å­©è¹²åœ¨ç‰†è§’å“­æ³£ï¼Œçœ‹èµ·ä¾†è¿·è·¯äº†ã€‚",
            choices: [
                { text: "ä¸Šå‰å®‰æ…°", action: () => {
                    log("å¥¹æŠ¬èµ·é ­ï¼Œè‡‰ä¸Šæ²’æœ‰äº”å®˜ã€‚å¥¹æŠ±ä½ä½ ï¼Œé–‹å§‹å¸é£Ÿä½ çš„é«”æº«ã€‚", "danger");
                    changeStat('corruption', 30);
                    changeStat('stamina', -30);
                }},
                { text: "ç”¨æ‰‹é›»ç­’ç…§", reqClue: "item_flashlight", action: () => {
                    log("åœ¨å¼·å…‰ä¸‹ï¼Œå°å¥³å­©çš„èº«å½±æ…¢æ…¢æ¶ˆæ•£äº†ã€‚", "success");
                    changeStat('sanity', 5);
                }},
                { text: "èº²å›ä¿å®‰å®¤", action: () => {
                    log("å“­è²è®Šæˆäº†å°–éŠ³çš„å¬‰ç¬‘è²ï¼Œæ¼¸æ¼¸é å»ã€‚", "event");
                    changeStat('sanity', -10);
                }}
            ]
        },
        "power_outage": {
            text: "å…¬å¯“çªç„¶åœé›»ï¼Œå››å‘¨é™·å…¥æ­»å¯‚ï¼Œä½ è½åˆ°åœ°æ¿ä¸Šå‚³ä¾†æ¿•è†©çš„çˆ¬è¡Œè²ã€‚",
            choices: [
                { text: "ç”¨æ‰‹é›»ç­’", reqClue: "item_flashlight", action: () => {
                    log("å…‰æŸé€¼é€€äº†é»‘æš—ä¸­é è¿‘çš„å½±å­ã€‚", "success");
                    changeStat('stamina', -5);
                }},
                { text: "ä¿æŒä¸å‹•", action: () => {
                    log("æœ‰æ±è¥¿çˆ¬éäº†ä½ çš„é‹é¢ï¼Œç•™ä¸‹ä¸€ç˜é»æ¶²ã€‚", "event");
                    changeStat('sanity', -20);
                    changeStat('corruption', 10);
                }},
                { text: "å»é…é›»å®¤", condition:()=>GameState.stamina > 30, action: () => {
                    log("é…é›»å®¤è£¡æ²¾æ»¿äº†é»æ¶²ï¼Œä½ æ»‘äº†ä¸€è·¤ã€‚", "danger");
                    changeStat('stamina', -20);
                    changeStat('corruption', 20);
                }}
            ]
        },
        "blood_moon": {
            text: "çª—å¤–çš„æœˆäº®è®Šæˆäº†é®®è¡€èˆ¬çš„ç´…è‰²ï¼Œå°‡æ•´å€‹å¤§å»³æŸ“æˆäº†è©­ç•°çš„ç·‹ç´…ã€‚",
            choices: [
                { text: "æ¬£è³", action: () => {
                    log("ä½ æ„Ÿè¦ºéˆé­‚æ­£åœ¨è¢«ä¸€é»é»å‰é›¢èº«é«”ã€‚", "danger");
                    changeStat('sanity', -40);
                    changeStat('corruption', 20);
                }},
                { text: "èº²æ¡Œä¸‹", action: () => {
                    log("ä½ èº²åœ¨æ¡Œä¸‹ç‘Ÿç‘Ÿç™¼æŠ–ï¼Œç›´åˆ°ç´…å…‰é€€å»ã€‚", "success");
                    changeStat('sanity', -20);
                }}
            ]
        },
        "red_lady_encounter": {
            text: "ç´…è¡£å¥³å­å‡ºç¾åœ¨ä½ é¢å‰ã€‚å¥¹çš„è‡‰è®Šæˆäº†ä½ æ¯è¦ªçš„æ¨£å­ï¼Œå¼µé–‹é›™è‡‚ç­‰ä½ ã€‚",
            choices: [
                { text: "å¾Œé€€", action: () => {
                    log("é‚£ä¸æ˜¯ä½ æ¯è¦ªï¼Œé‚£æ˜¯æ•£ç™¼è‘—æƒ¡è‡­çš„è…çˆ›å±é«”ã€‚", "success");
                    changeStat('sanity', -15);
                }},
                { text: "æ“æŠ±", action: () => {
                    log("å¥¹æŠ±ä½ä½ çš„ç¬é–“ï¼Œå°–éŠ³çš„è‚‹éª¨åˆºç©¿äº†ä½ çš„èƒ¸è†›ã€‚", "danger");
                    changeStat('stamina', -50);
                }},
                { text: "ç„¡è¦–é€šé", reqClue: "clue_red_lady", action: () => {
                    log("æ“¦è‚©è€Œéæ™‚ï¼Œä½ è½åˆ°è€³é‚Šå‚³ä¾†ï¼šã€ä½ çœ‹å¾—è¦‹æˆ‘ï¼Œå°å§ï¼Ÿã€", "success");
                    changeStat('sanity', -5);
                    changeStat('corruption', 5);
                }}
            ]
        },
        "mirror_reflection": {
            text: "ä½ ç…§é¡å­æ•´ç†å„€å®¹ï¼Œå»ç™¼ç¾é¡ä¸­çš„å€’å½±ç©¿è‘—ç´…è¡£ï¼Œæ­£å¾®ç¬‘è‘—å‘ä½ ä¼¸å‡ºæ‰‹ã€‚",
            choices: [
                { text: "æ‰“ç ´é¡å­", action: () => {
                    log("ä½ çš„æ‰‹æµè¡€äº†ï¼Œä½†é¡ä¸­çš„å€’å½±ç™¼å‡ºäº†æ·’å²çš„æ…˜å«ã€‚", "success");
                    changeStat('stamina', -20);
                    GameState.flags['mirror_broken'] = true;
                }},
                { text: "è©¢å•ç§˜å¯†", reqClue: "clue_mirror", action: () => {
                    log("å€’å½±çš„å˜´å”‡è •å‹•ï¼šã€å®ƒæ˜¯æ™‚é–“çš„å¥´éš¸ã€‚ã€", "success");
                    changeStat('sanity', -10);
                    GameState.clues.push('clue_final_hint');
                }},
                { text: "æ•´ç†åˆ¶æœ", action: () => {
                     log("ä½ çš„éˆé­‚å½·å½¿è¢«é¡å­æ‹‰æ‰¯ï¼ŒåŠ‡ç—›ç„¡æ¯”ã€‚", "danger");
                     changeStat('sanity', -30);
                     changeStat('corruption', 20);
                }}
            ]
        },
        "final_confrontation": {
            text: "é–€å¤–å‚³ä¾†æ—©ç­è€ç‹çš„æ±‚æ•‘è²ï¼šã€å¿«é–‹é–€å•Šï¼å¾Œé¢æœ‰æ€ªç‰©åœ¨è¿½æˆ‘ï¼ã€",
            choices: [
                { text: "é–‹é–€", action: () => {
                    log("é–€å¤–ç«™è‘—çš„åªæ˜¯ä¸€å¼µæ¼‚æµ®çš„äººçš®ã€‚ä½ çš„ç”Ÿå‘½åŠ›ç¬é–“è¢«æŠ½ç©ºã€‚", "danger");
                    changeStat('stamina', -90);
                }},
                { text: "æ­»å®ˆ", action: () => {
                    log("é–€æ¿è¢«ç˜‹ç‹‚æ’æ“Šï¼Œå½·å½¿éš¨æ™‚æœƒç¢è£‚ã€‚", "danger");
                    changeStat('stamina', -50);
                }},
                { text: "å•åå­—", reqClue: "clue_manager", action: () => {
                    log("é–€å¤–æ²‰é»˜äº†è¨±ä¹…ï¼Œå‚³ä¾†ä¸€è²ï¼šã€æˆ‘...å¿˜...äº†...ã€", "success");
                }}
            ]
        }
    };
</script>
</body>
</html>
